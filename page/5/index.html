<!DOCTYPE html>
<html lang="">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.9.0">
<script data-ad-client="ca-pub-1831623022964098" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <link rel="apple-touch-icon" sizes="180x180" href="/images/C_Meng.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/C_Meng.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/C_Meng.png">
  <link rel="mask-icon" href="/images/C_Meng.png" color="#222">
  <meta name="google-site-verification" content="-WnFIB8dOJwdL5b4iIfg6bNp1o-p5XnbyMIPVWXr6N0">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"imonce.github.io","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="A stupid old man with a humble learning heart. And his dog.">
<meta property="og:type" content="website">
<meta property="og:title" content="C_Meng PSNA">
<meta property="og:url" content="https://imonce.github.io/page/5/index.html">
<meta property="og:site_name" content="C_Meng PSNA">
<meta property="og:description" content="A stupid old man with a humble learning heart. And his dog.">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="C_Meng PSNA">
<meta name="twitter:description" content="A stupid old man with a humble learning heart. And his dog.">

<link rel="canonical" href="https://imonce.github.io/page/5/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'default'
  };
</script>

  <title>C_Meng PSNA</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">C_Meng PSNA</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Never wait for the storm to pass, just dance in the rain.</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">208</span></a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">32</span></a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">134</span></a>

  </li>
        <li class="menu-item menu-item-sitemap">

    <a href="/sitemap.xml" rel="section"><i class="fa fa-sitemap fa-fw"></i>Sitemap</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

  <a href="https://github.com/imonce" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="https://imonce.github.io/2019/11/04/常见QoS指标一览/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/C_Meng.png">
      <meta itemprop="name" content="C_Meng">
      <meta itemprop="description" content="A stupid old man with a humble learning heart. And his dog.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="C_Meng PSNA">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/11/04/常见QoS指标一览/" class="post-title-link" itemprop="url">常见QoS指标一览</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-11-04 16:22:15" itemprop="dateCreated datePublished" datetime="2019-11-04T16:22:15+08:00">2019-11-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-11-12 17:33:44" itemprop="dateModified" datetime="2019-11-12T17:33:44+08:00">2019-11-12</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2019/11/04/常见QoS指标一览/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/11/04/常见QoS指标一览/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
          
          <p>英文： Quality of Service<br>中文： 服务质量<br>介绍： 指一个网络能够利用各种基础技术，为指定的网络通信提供更好的服务能力，是网络的一种安全机制，<strong>是用来解决网络延迟和阻塞等问题的一种技术</strong>。 通过配置QoS，对企业的网络流量进行调控，避免并管理网络拥塞，减少报文的丢失率，同时也可以为企业用户提供专用带宽或者为不同的业务（语音、视频、数据等）提供差分服务。</p>
<p>在正常情况下，如果网络只用于特定的无时间限制的应用系统，并不需要QoS，比如Web应用，或E-mail设置等。但是对关键应用和多媒体应用就十分必要。当网络过载或拥塞时，==QoS能确保重要业务量不受延迟或丢弃==，同时保证网络的高效运行。在RFC 3644上有对QoS的说明。</p>
<h1 id="可用性-Usability"><a href="#可用性-Usability" class="headerlink" title="可用性(Usability)"></a>可用性(Usability)</h1><p>是当用户需要时网络即能工作的时间百分比。可用性主要是设备可靠性和网络存活性相结合的结果。对它起作用的还有一些其他因素，包括软件稳定性以及网络演进或升级时不中断服务的能力。 在连续5min内，如果一个IP网络所提供的丢包率&lt;=75%，则认为该时间段是可用的，否则是不可用的。</p>
<h1 id="吞吐量-网络带宽-Throughput"><a href="#吞吐量-网络带宽-Throughput" class="headerlink" title="吞吐量(网络带宽)(Throughput)"></a>吞吐量(网络带宽)(Throughput)</h1><p>网络带宽是指在单位时间（一般指的是1秒钟）内能传输的数据量。对IP网而言可以从帧中继网借用一些概念。根据应用和服务类型，服务水平协议(SLA)可以规定承诺信息速率(CIR)、突发信息速率(BIR)和最大突发信号长度。承诺信息速率是应该予以严格保证的，对突发信息速率可以有所限定，以在容纳预定长度突发信号的同时容纳从话音到视像以及一般数据的各种服务。一般讲，吞吐量越大越好。</p>
<h1 id="时延-Latency-Packet-delay"><a href="#时延-Latency-Packet-delay" class="headerlink" title="时延(Latency)(Packet delay)"></a>时延(Latency)(Packet delay)</h1><p>指一项服务从网络入口到出口的平均经过时间。许多服务，特别是话音和视像等实时服务都是高度不能容忍时延的。当时延超过200-250毫秒时，交互式会话是非常麻烦的。为了提供高质量话音和会议电视，网络设备必须能保证低的时延。<br>产生时延的因素很多，包括分组时延、排队时延、交换时延和传播时延。传播时延是信息通过铜线、光纤或无线链路所需的时间，它是光速的函数。在任何系统中，包括同步数字系列(SDH)、异步传输模式（ATM）和弹性分组环路(RPR)，传播时延总是存在的。</p>
<h1 id="时延变化-抖动-Packet-delay-variation"><a href="#时延变化-抖动-Packet-delay-variation" class="headerlink" title="时延变化(抖动)(Packet delay variation)"></a>时延变化(抖动)(Packet delay variation)</h1><p>是指同一业务流中不同分组所呈现的时延不同。高频率的时延变化称作抖动，而低频率的时延变化称作漂移。抖动主要是由于业务流中相继分组的排队等候时间不同引起的，是对服务质量影响最大的一个问题。</p>
<p>​某些业务类型（特别是语音和视频等实时业务）是极其不能容忍抖动的。报文到达时间的差异将在语音或视频中造成断续；另外，抖动也会影响一些网络协议的处理，有些协议是按固定的时间间隔发送交互性报文，抖动过大就会导致协议震荡，而实际上所有传输系统都有抖动，但只要抖动在规定容差之内就不会影响服务质量，另外，可利用缓存来克服过量的抖动，但这将会增加时延。</p>
<p>漂移是任何同步传输系统都有的一个问题。在SDH系统中是通过严格的全网分级定时来克服漂移的。在异步系统中，漂移一般不是问题。漂移会造成基群失帧，使服务质量的要求不能满足。</p>
<h1 id="丢包-Packet-loss"><a href="#丢包-Packet-loss" class="headerlink" title="丢包(Packet loss)"></a>丢包(Packet loss)</h1><p>不管是比特丢失还是分组丢失，对分组数据业务的影响比对实时业务的影响都大。在通话期间，丢失一个比特或一个分组的信息往往用户注意不到。在视像广播期间，这在屏幕上可能造成瞬间的波形干扰，然后视像很快恢复如初。即便是用传输控制协议(TCP)传送数据也能处理丢失，因为传输控制协议允许丢失的信息重发。事实上，一种叫做随机早丢(RED)的拥塞控制机制在故意丢失分组，其目的是在流量达到设定门限时抑制TCP传输速率，减少拥塞，同时还使TCP流失去同步，以防止因速率窗口的闭合引起吞吐量摆动。但分组丢失多了，会影响传输质量。所以，要保持统计数字，当超过预定门限时就向网络管理人员告警。</p>
<p>丢包（packetloss）可能在所有环节中发生，例如：</p>
<ul>
<li>处理过程：路由器在收到报文的时候可能由于CPU繁忙，无法处理报文而导致丢包；</li>
<li>排队过程：在把报文调度到队列的时候可能由于队列被装满而导致丢包；</li>
<li>传输过程：报文在链路上传输的过程中，可能由于种种原因（如链路故障等）导致的丢包。</li>
</ul>
<blockquote>
<p>References:<br><a href="https://blog.csdn.net/qq_25077833/article/details/53428655" target="_blank" rel="noopener">https://blog.csdn.net/qq_25077833/article/details/53428655</a><br><a href="https://blog.csdn.net/kakingka/article/details/45698709" target="_blank" rel="noopener">https://blog.csdn.net/kakingka/article/details/45698709</a><br><a href="https://blog.csdn.net/qq_38265137/article/details/80466737" target="_blank" rel="noopener">https://blog.csdn.net/qq_38265137/article/details/80466737</a></p>
</blockquote>

          
          
          
          
          
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="https://imonce.github.io/2019/10/21/3小时精通lxml-etree-Python中xml的读取、解析、生成和查找/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/C_Meng.png">
      <meta itemprop="name" content="C_Meng">
      <meta itemprop="description" content="A stupid old man with a humble learning heart. And his dog.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="C_Meng PSNA">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/21/3小时精通lxml-etree-Python中xml的读取、解析、生成和查找/" class="post-title-link" itemprop="url">3小时精通lxml.etree:Python中xml的读取、解析、生成和查找</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-10-21 17:04:41" itemprop="dateCreated datePublished" datetime="2019-10-21T17:04:41+08:00">2019-10-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-01-04 16:07:17" itemprop="dateModified" datetime="2020-01-04T16:07:17+08:00">2020-01-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Learn-X-in-Y-minutes/" itemprop="url" rel="index"><span itemprop="name">Learn X in Y minutes</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Learn-X-in-Y-minutes/Learn-lxml-etree-in-Y-minutes/" itemprop="url" rel="index"><span itemprop="name">Learn lxml.etree in Y minutes</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2019/10/21/3小时精通lxml-etree-Python中xml的读取、解析、生成和查找/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/10/21/3小时精通lxml-etree-Python中xml的读取、解析、生成和查找/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
          
          <p>本文主要参考官方文档<a href="https://lxml.de/tutorial.html" target="_blank" rel="noopener">https://lxml.de/tutorial.html</a>整理，如有错误欢迎指出。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml <span class="keyword">import</span> etree</span><br><span class="line"><span class="keyword">from</span> copy <span class="keyword">import</span> deepcopy</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加Element默认添加为根节点</span></span><br><span class="line">root = etree.Element(<span class="string">"root"</span>)</span><br><span class="line"><span class="comment"># 通过append添加子节点</span></span><br><span class="line">root.append(etree.Element(<span class="string">"child1"</span>))</span><br><span class="line"><span class="comment"># 通过SubElement添加子节点</span></span><br><span class="line">child2 = etree.SubElement(root, <span class="string">"child2"</span>)</span><br><span class="line">child3 = etree.SubElement(root, <span class="string">"child3"</span>)</span><br><span class="line">print(etree.tostring(root))</span><br><span class="line">print(etree.tostring(root, pretty_print=<span class="keyword">True</span>))</span><br><span class="line"><span class="comment"># 默认encoding是ASCII</span></span><br><span class="line">print(etree.tostring(root, encoding=<span class="string">'iso-8859-1'</span>))</span><br><span class="line"><span class="comment"># 如果要把byte转成str输出的话，可以用下边的语句</span></span><br><span class="line">print(str(etree.tostring(root, pretty_print=<span class="keyword">True</span>),encoding=<span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure>

<pre><code>b&#39;&lt;root&gt;&lt;child1/&gt;&lt;child2/&gt;&lt;child3/&gt;&lt;/root&gt;&#39;
b&#39;&lt;root&gt;\n  &lt;child1/&gt;\n  &lt;child2/&gt;\n  &lt;child3/&gt;\n&lt;/root&gt;\n&#39;
b&quot;&lt;?xml version=&#39;1.0&#39; encoding=&#39;iso-8859-1&#39;?&gt;\n&lt;root&gt;&lt;child1/&gt;&lt;child2/&gt;&lt;child3/&gt;&lt;/root&gt;&quot;
&lt;root&gt;
  &lt;child1/&gt;
  &lt;child2/&gt;
  &lt;child3/&gt;
&lt;/root&gt;</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 每个元素都是一个list</span></span><br><span class="line">child1 = root[<span class="number">0</span>]</span><br><span class="line"><span class="comment"># .tag 可以取出元素的标签</span></span><br><span class="line">print(child1.tag, len(root))</span><br><span class="line"><span class="comment"># 大部分list方法都可以使用在element上</span></span><br><span class="line">root.insert(<span class="number">0</span>, etree.Element(<span class="string">"child0"</span>))</span><br><span class="line">print(root[<span class="number">0</span>].tag)</span><br></pre></td></tr></table></figure>

<pre><code>child1 3
child0</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可以用list函数取出子元素的list</span></span><br><span class="line">children = list(root)</span><br><span class="line">print(root)</span><br><span class="line">print(children)</span><br></pre></td></tr></table></figure>

<pre><code>&lt;Element root at 0x107b03888&gt;
[&lt;Element child0 at 0x107b034c8&gt;, &lt;Element child1 at 0x107b03448&gt;, &lt;Element child2 at 0x107b038c8&gt;, &lt;Element child3 at 0x107b03908&gt;]</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过长度检查element是否为叶子节点</span></span><br><span class="line"><span class="keyword">if</span> len(root):</span><br><span class="line">    print(<span class="string">'root has children'</span>)</span><br><span class="line"><span class="keyword">if</span> len(child1):</span><br><span class="line">    print(<span class="string">'child1 has children'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'child1 has no child'</span>)</span><br></pre></td></tr></table></figure>

<pre><code>root has children
child1 has no child</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不同于普通list，赋值可能会造成元素移动</span></span><br><span class="line">print(etree.tostring(root))</span><br><span class="line">root[<span class="number">0</span>] = root[<span class="number">-1</span>]</span><br><span class="line">print(etree.tostring(root))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这是普通list</span></span><br><span class="line">l = [<span class="number">0</span>,<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]</span><br><span class="line">print(l)</span><br><span class="line">l[<span class="number">0</span>] = l[<span class="number">-1</span>]</span><br><span class="line">print(l)</span><br></pre></td></tr></table></figure>

<pre><code>b&#39;&lt;root&gt;&lt;child0/&gt;&lt;child1/&gt;&lt;child2/&gt;&lt;child3/&gt;&lt;/root&gt;&#39;
b&#39;&lt;root&gt;&lt;child3/&gt;&lt;child1/&gt;&lt;child2/&gt;&lt;/root&gt;&#39;
[0, 1, 2, 3]
[3, 1, 2, 3]</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 要拷贝节点，需要调用deepcopy</span></span><br><span class="line">newroot = etree.Element(<span class="string">'newroot'</span>)</span><br><span class="line">newroot.append(deepcopy(root[<span class="number">1</span>]))</span><br><span class="line">print(etree.tostring(root))</span><br><span class="line">print(etree.tostring(newroot))</span><br></pre></td></tr></table></figure>

<pre><code>b&#39;&lt;root&gt;&lt;child3/&gt;&lt;child1/&gt;&lt;child2/&gt;&lt;/root&gt;&#39;
b&#39;&lt;newroot&gt;&lt;child1/&gt;&lt;/newroot&gt;&#39;</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># etree元素自带方法可以找到对应的父节点、前一个节点、后一个节点</span></span><br><span class="line">print(root <span class="keyword">is</span> child1.getparent())</span><br><span class="line">print(root[<span class="number">0</span>] <span class="keyword">is</span> root[<span class="number">1</span>].getprevious())</span><br><span class="line">print(root[<span class="number">1</span>] <span class="keyword">is</span> root[<span class="number">0</span>].getnext())</span><br></pre></td></tr></table></figure>

<pre><code>True
True
True</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 属性以字典方式存储</span></span><br><span class="line">root = etree.Element(<span class="string">"root"</span>, interesting=<span class="string">"totally"</span>)</span><br><span class="line">print(etree.tostring(root))</span><br><span class="line"><span class="comment"># 通过get方法获取属性值</span></span><br><span class="line">print(root.get(<span class="string">"interesting"</span>))</span><br><span class="line">print(root.get(<span class="string">"hello"</span>))</span><br><span class="line"><span class="comment"># 通过set方法添加属性</span></span><br><span class="line">root.set(<span class="string">"hello"</span>, <span class="string">"Huhu"</span>)</span><br><span class="line">print(etree.tostring(root))</span><br></pre></td></tr></table></figure>

<pre><code>b&#39;&lt;root interesting=&quot;totally&quot;/&gt;&#39;
totally
None
b&#39;&lt;root interesting=&quot;totally&quot; hello=&quot;Huhu&quot;/&gt;&#39;</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 字典的相关方法也可以直接使用</span></span><br><span class="line">print(root.items(), root.keys(), root.values())</span><br><span class="line"></span><br><span class="line"><span class="comment"># 通过 attrib 可以直接取出属性进行操作</span></span><br><span class="line">attributes = root.attrib</span><br><span class="line">print(attributes.get(<span class="string">"no-such-attribute"</span>))</span><br><span class="line"><span class="keyword">None</span></span><br><span class="line">attributes[<span class="string">"hello"</span>] = <span class="string">"Guten Tag"</span></span><br><span class="line">print(attributes[<span class="string">"hello"</span>])</span><br><span class="line"><span class="comment"># root中的属性一并修改</span></span><br><span class="line">print(root.get(<span class="string">"hello"</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 也可以转化为纯正的dict</span></span><br><span class="line">d = dict(root.attrib)</span><br><span class="line">print(d.items())</span><br></pre></td></tr></table></figure>

<pre><code>[(&#39;interesting&#39;, &#39;totally&#39;), (&#39;hello&#39;, &#39;Huhu&#39;)] [&#39;interesting&#39;, &#39;hello&#39;] [&#39;totally&#39;, &#39;Huhu&#39;]
None
Guten Tag
Guten Tag
dict_items([(&#39;interesting&#39;, &#39;totally&#39;), (&#39;hello&#39;, &#39;Guten Tag&#39;)])</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 元素中包含文本</span></span><br><span class="line">root = etree.Element(<span class="string">"root"</span>)</span><br><span class="line">root.text = <span class="string">"Hello World"</span></span><br><span class="line">print(root.text)</span><br><span class="line">print(etree.tostring(root))</span><br></pre></td></tr></table></figure>

<pre><code>Hello World
b&#39;&lt;root&gt;Hello World&lt;/root&gt;&#39;</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 如何添加特殊元素类似于&lt;br/&gt;</span></span><br><span class="line">html = etree.Element(<span class="string">"html"</span>)</span><br><span class="line">body = etree.SubElement(html, <span class="string">"body"</span>)</span><br><span class="line">body.text = <span class="string">"TEXT"</span></span><br><span class="line"></span><br><span class="line">print(etree.tostring(html))</span><br><span class="line"></span><br><span class="line">br = etree.SubElement(body, <span class="string">"br"</span>)</span><br><span class="line">print(etree.tostring(html))</span><br><span class="line"></span><br><span class="line">br.tail = <span class="string">"TAIL"</span></span><br><span class="line">print(etree.tostring(html))</span><br><span class="line">body.text = <span class="string">"HEAD"</span></span><br><span class="line">print(etree.tostring(html))</span><br></pre></td></tr></table></figure>

<pre><code>b&#39;&lt;html&gt;&lt;body&gt;TEXT&lt;/body&gt;&lt;/html&gt;&#39;
b&#39;&lt;html&gt;&lt;body&gt;TEXT&lt;br/&gt;&lt;/body&gt;&lt;/html&gt;&#39;
b&#39;&lt;html&gt;&lt;body&gt;TEXT&lt;br/&gt;TAIL&lt;/body&gt;&lt;/html&gt;&#39;
b&#39;&lt;html&gt;&lt;body&gt;HEAD&lt;br/&gt;TAIL&lt;/body&gt;&lt;/html&gt;&#39;</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># tail其实属于前边元素的一部分</span></span><br><span class="line">print(etree.tostring(br))</span><br><span class="line">print(etree.tostring(br, with_tail=<span class="keyword">False</span>))</span><br><span class="line">print(etree.tostring(html, method=<span class="string">"text"</span>))</span><br></pre></td></tr></table></figure>

<pre><code>b&#39;&lt;br/&gt;TAIL&#39;
b&#39;&lt;br/&gt;&#39;
b&#39;HEADTAIL&#39;</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># xpath方法也可以使用</span></span><br><span class="line">print(html.xpath(<span class="string">"string()"</span>))</span><br><span class="line">print(html.xpath(<span class="string">"//text()"</span>))</span><br></pre></td></tr></table></figure>

<pre><code>HEADTAIL
[&#39;HEAD&#39;, &#39;TAIL&#39;]</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 甚至可以吧xpath的方法包装成函数</span></span><br><span class="line">build_text_list = etree.XPath(<span class="string">"//text()"</span>) <span class="comment"># lxml.etree only!</span></span><br><span class="line">print(build_text_list(html))</span><br></pre></td></tr></table></figure>

<pre><code>[&#39;HEAD&#39;, &#39;TAIL&#39;]</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># text也可以找爸爸</span></span><br><span class="line">texts = build_text_list(html)</span><br><span class="line">print(texts[<span class="number">0</span>])</span><br><span class="line"></span><br><span class="line">parent = texts[<span class="number">0</span>].getparent()</span><br><span class="line">print(parent.tag)</span><br><span class="line"></span><br><span class="line">print(texts[<span class="number">1</span>])</span><br><span class="line">print(texts[<span class="number">1</span>].getparent().tag)</span><br></pre></td></tr></table></figure>

<pre><code>HEAD
body
TAIL
br</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 判断一段文本是正常的文本还是tail</span></span><br><span class="line">print(texts[<span class="number">0</span>].is_text)</span><br><span class="line">print(texts[<span class="number">1</span>].is_text)</span><br><span class="line">print(texts[<span class="number">1</span>].is_tail)</span><br></pre></td></tr></table></figure>

<pre><code>True
False
True</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 但是XPath下有些方法就不行了</span></span><br><span class="line">stringify = etree.XPath(<span class="string">"string()"</span>)</span><br><span class="line">print(stringify(html))</span><br><span class="line">print(stringify(html).getparent())</span><br></pre></td></tr></table></figure>

<pre><code>HEADTAIL
None</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># etree中的树是iterable的</span></span><br><span class="line">root = etree.Element(<span class="string">"root"</span>)</span><br><span class="line">etree.SubElement(root, <span class="string">"child"</span>).text = <span class="string">"Child 1"</span></span><br><span class="line">etree.SubElement(root, <span class="string">"child"</span>).text = <span class="string">"Child 2"</span></span><br><span class="line">etree.SubElement(root, <span class="string">"another"</span>).text = <span class="string">"Child 3"</span></span><br><span class="line"></span><br><span class="line">print(etree.tostring(root, pretty_print=<span class="keyword">True</span>))</span><br><span class="line"><span class="keyword">for</span> element <span class="keyword">in</span> root.iter():</span><br><span class="line">    print(<span class="string">"%s - %s"</span> % (element.tag, element.text))</span><br></pre></td></tr></table></figure>

<pre><code>b&#39;&lt;root&gt;\n  &lt;child&gt;Child 1&lt;/child&gt;\n  &lt;child&gt;Child 2&lt;/child&gt;\n  &lt;another&gt;Child 3&lt;/another&gt;\n&lt;/root&gt;\n&#39;
root - None
child - Child 1
child - Child 2
another - Child 3</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 可以通过在iter中添加参数，来过滤输出的tag</span></span><br><span class="line"><span class="keyword">for</span> element <span class="keyword">in</span> root.iter(<span class="string">"child"</span>):</span><br><span class="line">    print(<span class="string">"%s - %s"</span> % (element.tag, element.text))</span><br><span class="line"><span class="keyword">for</span> element <span class="keyword">in</span> root.iter(<span class="string">"another"</span>, <span class="string">"child"</span>):</span><br><span class="line">    print(<span class="string">"%s - %s"</span> % (element.tag, element.text))</span><br></pre></td></tr></table></figure>

<pre><code>child - Child 1
child - Child 2
child - Child 1
child - Child 2
another - Child 3</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 默认情况下，所有节点都会被遍历，如Entity、Comment等，通过添加tag参数可以避免这一点</span></span><br><span class="line">root.append(etree.Entity(<span class="string">"#234"</span>))</span><br><span class="line">root.append(etree.Comment(<span class="string">"some comment"</span>))</span><br><span class="line">print(etree.tostring(root))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> element <span class="keyword">in</span> root.iter():</span><br><span class="line">    <span class="keyword">if</span> isinstance(element.tag, str):</span><br><span class="line">        print(<span class="string">"%s - %s"</span> % (element.tag, element.text))</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        print(<span class="string">"SPECIAL: %s - %s"</span> % (element, element.text))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> element <span class="keyword">in</span> root.iter(tag=etree.Element):</span><br><span class="line">    print(<span class="string">"%s - %s"</span> % (element.tag, element.text))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> element <span class="keyword">in</span> root.iter(tag=etree.Entity):</span><br><span class="line">    print(element.text)</span><br></pre></td></tr></table></figure>

<pre><code>b&#39;&lt;root&gt;&lt;child&gt;Child 1&lt;/child&gt;&lt;child&gt;Child 2&lt;/child&gt;&lt;another&gt;Child 3&lt;/another&gt;&amp;#234;&lt;!--some comment--&gt;&lt;/root&gt;&#39;
root - None
child - Child 1
child - Child 2
another - Child 3
SPECIAL: &amp;#234; - &amp;#234;
SPECIAL: &lt;!--some comment--&gt; - some comment
root - None
child - Child 1
child - Child 2
another - Child 3
&amp;#234;</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过elementTreeName.write(filePath)可以把树写进文件或通过url传输</span></span><br><span class="line"><span class="comment"># 或者如果你只有elementName的话，可以这么写：</span></span><br><span class="line"><span class="comment"># etree.ElementTree(elementName).write(filePath)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 简单粗暴的直接写xml也可以</span></span><br><span class="line">root = etree.XML(</span><br><span class="line">   <span class="string">'&lt;html&gt;&lt;head/&gt;&lt;body&gt;&lt;p&gt;Hello&lt;br/&gt;World&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;'</span>)</span><br><span class="line"><span class="comment"># 通过method参数，可以序列化为不同格式，默认method = 'xml'</span></span><br><span class="line">print(etree.tostring(root))</span><br><span class="line">print(etree.tostring(root, method=<span class="string">'html'</span>))</span><br><span class="line">print(etree.tostring(root, method=<span class="string">'text'</span>))</span><br></pre></td></tr></table></figure>

<pre><code>b&#39;&lt;html&gt;&lt;head/&gt;&lt;body&gt;&lt;p&gt;Hello&lt;br/&gt;World&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;&#39;
b&#39;&lt;html&gt;&lt;head&gt;&lt;/head&gt;&lt;body&gt;&lt;p&gt;Hello&lt;br&gt;World&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;&#39;
b&#39;HelloWorld&#39;</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ElementTree class，是一个element的容器，提供了一些方法来对整个root node文档进行操作</span></span><br><span class="line">root = etree.XML(<span class="string">'''\</span></span><br><span class="line"><span class="string">&lt;?xml version="1.0"?&gt;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE root SYSTEM "test" [ &lt;!ENTITY tasty "parsnips"&gt; ]&gt;</span></span><br><span class="line"><span class="string">&lt;root&gt;</span></span><br><span class="line"><span class="string">  &lt;a&gt;&amp;tasty;&lt;/a&gt;</span></span><br><span class="line"><span class="string">&lt;/root&gt;</span></span><br><span class="line"><span class="string">'''</span>)</span><br><span class="line"></span><br><span class="line">tree = etree.ElementTree(root)</span><br><span class="line">print(tree.docinfo.xml_version)</span><br><span class="line">print(tree.docinfo.doctype)</span><br><span class="line"></span><br><span class="line">tree.docinfo.public_id = <span class="string">'-//W3C//DTD XHTML 1.0 Transitional//EN'</span></span><br><span class="line">tree.docinfo.system_url = <span class="string">'file://local.dtd'</span></span><br><span class="line">print(tree.docinfo.doctype)</span><br></pre></td></tr></table></figure>

<pre><code>1.0
&lt;!DOCTYPE root SYSTEM &quot;test&quot;&gt;
&lt;!DOCTYPE root PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;file://local.dtd&quot;&gt;</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">print(etree.tostring(tree))</span><br><span class="line">print(etree.tostring(tree.getroot()))</span><br></pre></td></tr></table></figure>

<pre><code>b&#39;&lt;!DOCTYPE root PUBLIC &quot;-//W3C//DTD XHTML 1.0 Transitional//EN&quot; &quot;file://local.dtd&quot; [\n&lt;!ENTITY tasty &quot;parsnips&quot;&gt;\n]&gt;\n&lt;root&gt;\n  &lt;a&gt;parsnips&lt;/a&gt;\n&lt;/root&gt;&#39;
b&#39;&lt;root&gt;\n  &lt;a&gt;parsnips&lt;/a&gt;\n&lt;/root&gt;&#39;</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 解析文档中以string读入的xml</span></span><br><span class="line">some_xml_data = <span class="string">"&lt;root&gt;data&lt;/root&gt;"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># .fromstring函数其实和.XML差不多</span></span><br><span class="line">root = etree.fromstring(some_xml_data)</span><br><span class="line">print(etree.tostring(root))</span><br></pre></td></tr></table></figure>

<pre><code>b&#39;&lt;root&gt;data&lt;/root&gt;&#39;</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 二进制读取解析</span></span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"></span><br><span class="line">some_file_or_file_like_object = BytesIO(<span class="string">b"&lt;root&gt;data&lt;/root&gt;"</span>)</span><br><span class="line">tree = etree.parse(some_file_or_file_like_object)</span><br><span class="line">print(etree.tostring(tree))</span><br><span class="line"><span class="comment"># 注意：parse函数返回的是ElementTree对象，不是Element，通过getroot可以转化为Element对象</span></span><br><span class="line"><span class="comment"># ElementTree和Element在某些方面相似，但是方法调用上不同，比如.tag只有Element可以使用</span></span><br><span class="line">root = tree.getroot()</span><br><span class="line">print(etree.tostring(root))</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    print(<span class="string">"tree执行:"</span>, tree.tag)</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">    print(<span class="string">"root执行:"</span>, root.tag)</span><br></pre></td></tr></table></figure>

<pre><code>b&#39;&lt;root&gt;data&lt;/root&gt;&#39;
b&#39;&lt;root&gt;data&lt;/root&gt;&#39;
root执行: root</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># parser对象</span></span><br><span class="line">parser = etree.XMLParser(remove_blank_text=<span class="keyword">True</span>)</span><br><span class="line">root = etree.XML(<span class="string">"&lt;root&gt;  &lt;a/&gt;   &lt;b&gt;  &lt;/b&gt;     &lt;/root&gt;"</span>, parser)</span><br><span class="line">print(etree.tostring(root))</span><br></pre></td></tr></table></figure>

<pre><code>b&#39;&lt;root&gt;&lt;a/&gt;&lt;b&gt;  &lt;/b&gt;&lt;/root&gt;&#39;</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Incremental parsing增量解析，比如在网络分步传输的场景下需要使用</span></span><br><span class="line"><span class="comment"># 方法一</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DataSource</span>:</span></span><br><span class="line">    data = [ <span class="string">b"&lt;roo"</span>, <span class="string">b"t&gt;&lt;"</span>, <span class="string">b"a/"</span>, <span class="string">b"&gt;&lt;"</span>, <span class="string">b"/root&gt;"</span> ]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read</span><span class="params">(self, requested_size)</span>:</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">return</span> self.data.pop(<span class="number">0</span>)</span><br><span class="line">        <span class="keyword">except</span> IndexError:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">b''</span></span><br><span class="line"></span><br><span class="line">        tree = etree.parse(DataSource())</span><br><span class="line">print(etree.tostring(tree))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 方法二</span></span><br><span class="line">parser = etree.XMLParser()</span><br><span class="line"></span><br><span class="line">parser.feed(<span class="string">"&lt;roo"</span>)</span><br><span class="line">parser.feed(<span class="string">"t&gt;&lt;"</span>)</span><br><span class="line">parser.feed(<span class="string">"a/"</span>)</span><br><span class="line">parser.feed(<span class="string">"&gt;&lt;"</span>)</span><br><span class="line">parser.feed(<span class="string">"/root&gt;"</span>)</span><br><span class="line"></span><br><span class="line">root = parser.close()</span><br><span class="line">print(etree.tostring(root))</span><br></pre></td></tr></table></figure>

<pre><code>b&#39;&lt;root&gt;data&lt;/root&gt;&#39;
b&#39;&lt;root&gt;&lt;a/&gt;&lt;/root&gt;&#39;</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Event-driven parsing事件驱动的解析，如只需要很大的树中的一小部分时使用</span></span><br><span class="line"><span class="comment"># 方法一</span></span><br><span class="line"><span class="comment"># iterparse默认只解析end事件</span></span><br><span class="line">some_file_like = BytesIO(<span class="string">b"&lt;root&gt;&lt;a&gt;data&lt;/a&gt;&lt;/root&gt;"</span>)</span><br><span class="line"><span class="keyword">for</span> event, element <span class="keyword">in</span> etree.iterparse(some_file_like):</span><br><span class="line">    print(<span class="string">"%s, %4s, %s"</span> % (event, element.tag, element.text))</span><br><span class="line">    </span><br><span class="line">print()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 可以修改events参数解析所有事件</span></span><br><span class="line">some_file_like = BytesIO(<span class="string">b"&lt;root&gt;&lt;a&gt;data&lt;/a&gt;&lt;/root&gt;"</span>)</span><br><span class="line"><span class="keyword">for</span> event, element <span class="keyword">in</span> etree.iterparse(some_file_like,</span><br><span class="line">                                      events=(<span class="string">"start"</span>, <span class="string">"end"</span>)):</span><br><span class="line">    print(<span class="string">"%5s, %4s, %s"</span> % (event, element.tag, element.text))</span><br></pre></td></tr></table></figure>

<pre><code>end,    a, data
end, root, None

start, root, None
start,    a, data
  end,    a, data
  end, root, None</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方法二</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ParserTarget</span>:</span></span><br><span class="line">    events = []</span><br><span class="line">    close_count = <span class="number">0</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">start</span><span class="params">(self, tag, attrib)</span>:</span></span><br><span class="line">        self.events.append((<span class="string">"start"</span>, tag, attrib))</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">close</span><span class="params">(self)</span>:</span></span><br><span class="line">        events, self.events = self.events, []</span><br><span class="line">        self.close_count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> events</span><br><span class="line"></span><br><span class="line">parser_target = ParserTarget()</span><br><span class="line"></span><br><span class="line">parser = etree.XMLParser(target=parser_target)</span><br><span class="line">events = etree.fromstring(<span class="string">'&lt;root test="true"/&gt;'</span>, parser)</span><br><span class="line"></span><br><span class="line">print(parser_target.close_count)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> events:</span><br><span class="line">    print(<span class="string">'event: %s - tag: %s'</span> % (event[<span class="number">0</span>], event[<span class="number">1</span>]))</span><br><span class="line">    <span class="keyword">for</span> attr, value <span class="keyword">in</span> event[<span class="number">2</span>].items():</span><br><span class="line">        print(<span class="string">' * %s = %s'</span> % (attr, value))</span><br></pre></td></tr></table></figure>

<pre><code>1
event: start - tag: root
 * test = true


/Users/imonce/anaconda/lib/python3.6/site-packages/ipykernel_launcher.py:15: DeprecationWarning: inspect.getargspec() is deprecated, use inspect.signature() or inspect.getfullargspec()
  from ipykernel import kernelapp as app</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">events = etree.fromstring(<span class="string">'&lt;root test="true"/&gt;'</span>, parser)</span><br><span class="line">print(parser_target.close_count)</span><br><span class="line">events = etree.fromstring(<span class="string">'&lt;root test="true"/&gt;'</span>, parser)</span><br><span class="line">print(parser_target.close_count)</span><br></pre></td></tr></table></figure>

<pre><code>2
3</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> event <span class="keyword">in</span> events:</span><br><span class="line">    print(<span class="string">'event: %s - tag: %s'</span> % (event[<span class="number">0</span>], event[<span class="number">1</span>]))</span><br><span class="line">    <span class="keyword">for</span> attr, value <span class="keyword">in</span> event[<span class="number">2</span>].items():</span><br><span class="line">        print(<span class="string">' * %s = %s'</span> % (attr, value))</span><br></pre></td></tr></table></figure>

<pre><code>event: start - tag: root
 * test = true</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># namespace命名空间，格式为：&#123;namespace_name&#125;tag_name</span></span><br><span class="line"><span class="comment"># 一般是链接，空链接的话会 ns+编号 给一个代号</span></span><br><span class="line"><span class="comment"># a:b的tag名会直接报错</span></span><br><span class="line">xhtml = etree.Element(<span class="string">"&#123;http://www.w3.org/1999/test&#125;testhtml"</span>)</span><br><span class="line">body = etree.SubElement(xhtml, <span class="string">"&#123;http://www.w3.org/1999/test&#125;tbody"</span>)</span><br><span class="line">body.text = <span class="string">"Hello World"</span></span><br><span class="line"></span><br><span class="line">print(etree.tostring(xhtml))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 高贵的html</span></span><br><span class="line">xhtml = etree.Element(<span class="string">"&#123;http://www.w3.org/1999/xhtml&#125;html"</span>)</span><br><span class="line">body = etree.SubElement(xhtml, <span class="string">"&#123;http://www.w3.org/1999/xhtml&#125;body"</span>)</span><br><span class="line">body.text = <span class="string">"Hello World"</span></span><br><span class="line"></span><br><span class="line">print(etree.tostring(xhtml))</span><br></pre></td></tr></table></figure>

<pre><code>b&#39;&lt;ns0:testhtml xmlns:ns0=&quot;http://www.w3.org/1999/test&quot;&gt;&lt;ns0:tbody&gt;Hello World&lt;/ns0:tbody&gt;&lt;/ns0:testhtml&gt;&#39;
b&#39;&lt;html:html xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot;&gt;&lt;html:body&gt;Hello World&lt;/html:body&gt;&lt;/html:html&gt;&#39;</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 设置默认命名空间</span></span><br><span class="line">XHTML_NAMESPACE = <span class="string">"http://www.w3.org/1999/xhtml"</span></span><br><span class="line">XHTML = <span class="string">"&#123;%s&#125;"</span> % XHTML_NAMESPACE</span><br><span class="line"></span><br><span class="line">NSMAP = &#123;<span class="keyword">None</span> : XHTML_NAMESPACE&#125; <span class="comment"># the default namespace (no prefix)</span></span><br><span class="line">xhtml = etree.Element(XHTML + <span class="string">"html"</span>, nsmap=NSMAP) <span class="comment"># lxml only!</span></span><br><span class="line">body = etree.SubElement(xhtml, XHTML + <span class="string">"body"</span>)</span><br><span class="line">body.text = <span class="string">"Hello World"</span></span><br><span class="line">print(etree.tostring(xhtml))</span><br></pre></td></tr></table></figure>

<pre><code>b&#39;&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;&lt;body&gt;Hello World&lt;/body&gt;&lt;/html&gt;&#39;</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># QName方法，快速合成或提取namespace</span></span><br><span class="line">tag = etree.QName(<span class="string">'http://www.w3.org/1999/xhtml'</span>, <span class="string">'html'</span>)</span><br><span class="line">print(tag.localname)</span><br><span class="line">print(tag.namespace)</span><br><span class="line">print(tag.text)</span><br><span class="line"></span><br><span class="line">root = etree.Element(<span class="string">'&#123;http://www.w3.org/1999/xhtml&#125;html'</span>)</span><br><span class="line">tag = etree.QName(root)</span><br><span class="line">print(tag.localname)</span><br></pre></td></tr></table></figure>

<pre><code>html
http://www.w3.org/1999/xhtml
{http://www.w3.org/1999/xhtml}html
html</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># nsmap方法，直接提取命名空间字典</span></span><br><span class="line">print(xhtml.nsmap)</span><br></pre></td></tr></table></figure>

<pre><code>{None: &#39;http://www.w3.org/1999/xhtml&#39;}</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 子元素继承父元素命名空间</span></span><br><span class="line">root = etree.Element(<span class="string">'root'</span>, nsmap=&#123;<span class="string">'a'</span>: <span class="string">'http://a.b/c'</span>&#125;)</span><br><span class="line">child = etree.SubElement(root, <span class="string">'child'</span>,</span><br><span class="line">                         nsmap=&#123;<span class="string">'b'</span>: <span class="string">'http://b.c/d'</span>&#125;)</span><br><span class="line">print(root.nsmap)</span><br><span class="line">print(child.nsmap)</span><br></pre></td></tr></table></figure>

<pre><code>{&#39;a&#39;: &#39;http://a.b/c&#39;}
{&#39;b&#39;: &#39;http://b.c/d&#39;, &#39;a&#39;: &#39;http://a.b/c&#39;}</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 添加带命名空间的属性，格式为：set(&#123;namespace_name&#125;attr_name, attr_value)</span></span><br><span class="line">body.set(XHTML + <span class="string">"bgcolor"</span>, <span class="string">"#CCFFAA"</span>)</span><br><span class="line">print(etree.tostring(xhtml))</span><br><span class="line"><span class="comment"># 注意：get的时候也要带命名空间</span></span><br><span class="line">print(body.get(<span class="string">"bgcolor"</span>))</span><br><span class="line">print(body.get(XHTML+<span class="string">"bgcolor"</span>))</span><br></pre></td></tr></table></figure>

<pre><code>b&#39;&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;&lt;body xmlns:html=&quot;http://www.w3.org/1999/xhtml&quot; html:bgcolor=&quot;#CCFFAA&quot;&gt;Hello World&lt;/body&gt;&lt;/html&gt;&#39;
None
#CCFFAA</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 也可以用XPath</span></span><br><span class="line">find_xhtml_body = etree.ETXPath(      <span class="comment"># lxml only !</span></span><br><span class="line">    <span class="string">"//&#123;%s&#125;body"</span> % XHTML_NAMESPACE)</span><br><span class="line">results = find_xhtml_body(xhtml)</span><br><span class="line"></span><br><span class="line">print(results[<span class="number">0</span>].tag)</span><br></pre></td></tr></table></figure>

<pre><code>{http://www.w3.org/1999/xhtml}body</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># iter的话也要考虑namespace</span></span><br><span class="line"><span class="keyword">for</span> el <span class="keyword">in</span> xhtml.iter(<span class="string">'&#123;*&#125;body'</span>): print(el.tag)</span><br></pre></td></tr></table></figure>

<pre><code>{http://www.w3.org/1999/xhtml}body</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># E-factory：提供一种简单紧凑的语法来生成XML和HTML</span></span><br><span class="line"><span class="keyword">from</span> lxml.builder <span class="keyword">import</span> E</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">CLASS</span><span class="params">(*args)</span>:</span> <span class="comment"># class 是python中的保留字，无法直接当做属性名</span></span><br><span class="line">    <span class="keyword">return</span> &#123;<span class="string">"class"</span>:<span class="string">' '</span>.join(args)&#125;</span><br><span class="line"></span><br><span class="line">html = page = (</span><br><span class="line">  E.html(       <span class="comment"># create an Element called "html"</span></span><br><span class="line">    E.head(</span><br><span class="line">      E.title(<span class="string">"This is a sample document"</span>)</span><br><span class="line">    ),</span><br><span class="line">    E.body(</span><br><span class="line">      E.h1(<span class="string">"Hello!"</span>, CLASS(<span class="string">"title"</span>)),</span><br><span class="line">      E.p(<span class="string">"This is a paragraph with "</span>, E.b(<span class="string">"bold"</span>), <span class="string">" text in it!"</span>),</span><br><span class="line">      E.p(<span class="string">"This is another paragraph, with a"</span>, <span class="string">"\n      "</span>,</span><br><span class="line">        E.a(<span class="string">"link"</span>, href=<span class="string">"http://www.python.org"</span>), <span class="string">"."</span>),</span><br><span class="line">      E.p(<span class="string">"Here are some reserved characters: &lt;spam&amp;egg&gt;."</span>),</span><br><span class="line">      etree.XML(<span class="string">"&lt;p&gt;And finally an embedded XHTML fragment.&lt;/p&gt;"</span>),</span><br><span class="line">    )</span><br><span class="line">  )</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">print(str(etree.tostring(page, pretty_print=<span class="keyword">True</span>),encoding=<span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure>

<pre><code>&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;This is a sample document&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1 class=&quot;title&quot;&gt;Hello!&lt;/h1&gt;
    &lt;p&gt;This is a paragraph with &lt;b&gt;bold&lt;/b&gt; text in it!&lt;/p&gt;
    &lt;p&gt;This is another paragraph, with a
      &lt;a href=&quot;http://www.python.org&quot;&gt;link&lt;/a&gt;.&lt;/p&gt;
    &lt;p&gt;Here are some reserved characters: &amp;lt;spam&amp;amp;egg&amp;gt;.&lt;/p&gt;
    &lt;p&gt;And finally an embedded XHTML fragment.&lt;/p&gt;
  &lt;/body&gt;
&lt;/html&gt;</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 此外还有一种基于属性的方法</span></span><br><span class="line"><span class="keyword">from</span> lxml.builder <span class="keyword">import</span> ElementMaker <span class="comment"># lxml only !</span></span><br><span class="line"></span><br><span class="line">E = ElementMaker(namespace=<span class="string">"http://my.de/fault/namespace"</span>,</span><br><span class="line">                 nsmap=&#123;<span class="string">'p'</span> : <span class="string">"http://my.de/fault/namespace"</span>&#125;)</span><br><span class="line"></span><br><span class="line">DOC = E.doc</span><br><span class="line">TITLE = E.title</span><br><span class="line">SECTION = E.section</span><br><span class="line">PAR = E.par</span><br><span class="line"></span><br><span class="line">my_doc = DOC(</span><br><span class="line">  TITLE(<span class="string">"The dog and the hog"</span>),</span><br><span class="line">  SECTION(</span><br><span class="line">    TITLE(<span class="string">"The dog"</span>, tType=<span class="string">'title'</span>),</span><br><span class="line">    PAR(<span class="string">"Once upon a time, ..."</span>),</span><br><span class="line">    PAR(<span class="string">"And then ..."</span>)</span><br><span class="line">  ),</span><br><span class="line">  SECTION(</span><br><span class="line">    TITLE(<span class="string">"The hog"</span>),</span><br><span class="line">    PAR(<span class="string">"Sooner or later ..."</span>)</span><br><span class="line">  )</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">print(str(etree.tostring(my_doc, pretty_print=<span class="keyword">True</span>),encoding=<span class="string">'utf-8'</span>))</span><br></pre></td></tr></table></figure>

<pre><code>&lt;p:doc xmlns:p=&quot;http://my.de/fault/namespace&quot;&gt;
  &lt;p:title&gt;The dog and the hog&lt;/p:title&gt;
  &lt;p:section&gt;
    &lt;p:title tType=&quot;title&quot;&gt;The dog&lt;/p:title&gt;
    &lt;p:par&gt;Once upon a time, ...&lt;/p:par&gt;
    &lt;p:par&gt;And then ...&lt;/p:par&gt;
  &lt;/p:section&gt;
  &lt;p:section&gt;
    &lt;p:title&gt;The hog&lt;/p:title&gt;
    &lt;p:par&gt;Sooner or later ...&lt;/p:par&gt;
  &lt;/p:section&gt;
&lt;/p:doc&gt;</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># XPath的一些例子</span></span><br><span class="line">root = etree.XML(<span class="string">"&lt;root&gt;&lt;a x='123'&gt;aText&lt;b/&gt;&lt;c/&gt;&lt;b/&gt;&lt;/a&gt;&lt;/root&gt;"</span>)</span><br><span class="line"><span class="comment"># 找儿子（单层子节点）</span></span><br><span class="line">print(root.find(<span class="string">"b"</span>))</span><br><span class="line">print(root.find(<span class="string">"a"</span>).tag)</span><br></pre></td></tr></table></figure>

<pre><code>None
a</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 找孩子（所有子节点）</span></span><br><span class="line">print(root.find(<span class="string">".//b"</span>).tag)</span><br></pre></td></tr></table></figure>

<pre><code>b</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 带属性找孩子</span></span><br><span class="line">print(root.findall(<span class="string">".//a[@x]"</span>)[<span class="number">0</span>].tag)</span><br></pre></td></tr></table></figure>

<pre><code>a</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 通过ElementTree找路径</span></span><br><span class="line">tree = etree.ElementTree(root)</span><br><span class="line">a = root[<span class="number">0</span>]</span><br><span class="line">print(tree.getelementpath(a[<span class="number">0</span>]))</span><br><span class="line">print(tree.getelementpath(a[<span class="number">1</span>]))</span><br><span class="line">print(tree.getelementpath(a[<span class="number">2</span>]))</span><br></pre></td></tr></table></figure>

<pre><code>a/b[1]
a/c
a/b[2]</code></pre>

          
          
          
          
          
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="https://imonce.github.io/2019/10/21/通过TensorFlow实现word-embedding/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/C_Meng.png">
      <meta itemprop="name" content="C_Meng">
      <meta itemprop="description" content="A stupid old man with a humble learning heart. And his dog.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="C_Meng PSNA">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/21/通过TensorFlow实现word-embedding/" class="post-title-link" itemprop="url">通过TensorFlow实现word embedding</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-10-21 10:16:01" itemprop="dateCreated datePublished" datetime="2019-10-21T10:16:01+08:00">2019-10-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-01-04 16:02:49" itemprop="dateModified" datetime="2020-01-04T16:02:49+08:00">2020-01-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Python/" itemprop="url" rel="index"><span itemprop="name">Python</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2019/10/21/通过TensorFlow实现word-embedding/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/10/21/通过TensorFlow实现word-embedding/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
          
          <p>word2vec的方法主要分为CBOW（Continuous Bag Of Words）和skip-gram（n-gram）两大类。</p>
<p>两种方法互为镜像。简单来说，CBOW是通过上下文预测中间值来进行训练的，skip-gram是通过中间值预测上下文来进行训练的。</p>
<p>这里，我们使用skip-gram的方法。</p>
<h1 id="python脚本"><a href="#python脚本" class="headerlink" title="python脚本"></a>python脚本</h1><p>IDE: jupyter notebook</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> absolute_import</span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> division</span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sklearn.manifold <span class="keyword">import</span> TSNE</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> collections</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> six.moves <span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">from</span> six.moves <span class="keyword">import</span> xrange</span><br><span class="line"><span class="keyword">import</span> tensorflow <span class="keyword">as</span> tf</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">BasicPatternEmbedding</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        self.url = <span class="string">'http://mattmahoney.net/dc/'</span></span><br><span class="line">        self.data_index = <span class="number">0</span></span><br><span class="line">        </span><br><span class="line">        self.vocabulary_size = <span class="number">5000</span></span><br><span class="line">        </span><br><span class="line">        self.batch_size = <span class="number">128</span></span><br><span class="line">        self.embedding_size = <span class="number">128</span>  <span class="comment"># Dimension of the embedding vector.</span></span><br><span class="line">        self.skip_window = <span class="number">1</span>       <span class="comment"># How many words to consider left and right.</span></span><br><span class="line">        self.num_skips = <span class="number">2</span>         <span class="comment"># How many times to reuse an input to generate a label.</span></span><br><span class="line"></span><br><span class="line">        <span class="comment"># We pick a random validation set to sample nearest neighbors. Here we limit the</span></span><br><span class="line">        <span class="comment"># validation samples to the words that have a low numeric ID, which by</span></span><br><span class="line">        <span class="comment"># construction are also the most frequent.</span></span><br><span class="line">        self.valid_size = <span class="number">16</span>     <span class="comment"># Random set of words to evaluate similarity on.</span></span><br><span class="line">        self.valid_window = <span class="number">100</span>  <span class="comment"># Only pick dev samples in the head of the distribution.</span></span><br><span class="line">        <span class="comment"># choose 16 numbers from 0 to 99 randomly</span></span><br><span class="line">        self.valid_examples = np.random.choice(self.valid_window, self.valid_size, replace=<span class="keyword">False</span>)</span><br><span class="line">        self.num_sampled = <span class="number">64</span>    <span class="comment"># Number of negative examples to sample.</span></span><br><span class="line">        self.num_steps = <span class="number">10001</span></span><br><span class="line">        </span><br><span class="line">        self.final_embedding = <span class="keyword">None</span></span><br><span class="line">        </span><br><span class="line">        self.graph = tf.Graph()</span><br><span class="line">        </span><br><span class="line">    <span class="comment"># download and verify the dataset file</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">maybe_download</span><span class="params">(self, filename, expected_bytes)</span>:</span></span><br><span class="line">        <span class="comment"># If the dataset file is not under the current path, download it directly</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(filename):</span><br><span class="line">            filename, _ = urllib.request.urlretrieve(self.url + filename, filename)</span><br><span class="line">        <span class="comment"># get dataset file infomationn</span></span><br><span class="line">        statinfo = os.stat(filename)</span><br><span class="line">        <span class="comment"># verify file size</span></span><br><span class="line">        <span class="keyword">if</span> statinfo.st_size == expected_bytes:</span><br><span class="line">            print(<span class="string">'Found and verified'</span>, filename)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(statinfo.st_size)</span><br><span class="line">            <span class="keyword">raise</span> Exception(</span><br><span class="line">                <span class="string">'Failed to verify '</span> + filename + <span class="string">'. Can you get to it with a browser?'</span>)</span><br><span class="line">        <span class="keyword">return</span> filename</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># read the data from zip into a list of strings</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">read_data</span><span class="params">(self, filename)</span>:</span></span><br><span class="line">        <span class="keyword">with</span> zipfile.ZipFile(filename) <span class="keyword">as</span> f:</span><br><span class="line">            <span class="comment"># separate by default separators, that is, all null characters, including spaces, newlines (\n), tabs (\t), etc.</span></span><br><span class="line">            data = tf.compat.as_str(f.read(f.namelist()[<span class="number">0</span>])).split()</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># process raw inputs into a dataset</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_dataset</span><span class="params">(self, words)</span>:</span></span><br><span class="line">        <span class="comment"># add unknown words into count list</span></span><br><span class="line">        count = [[<span class="string">'UNK'</span>, <span class="number">-1</span>]]</span><br><span class="line">        <span class="comment"># count the words list and add the pairs (word_name, number) into count list</span></span><br><span class="line">        count.extend(collections.Counter(words).most_common(self.vocabulary_size - <span class="number">1</span>))</span><br><span class="line">        dictionary = dict()</span><br><span class="line">        <span class="comment"># create a dictionary of the words with serial number</span></span><br><span class="line">        <span class="keyword">for</span> word, _ <span class="keyword">in</span> count:</span><br><span class="line">            dictionary[word] = len(dictionary)</span><br><span class="line">        data = list()</span><br><span class="line">        unk_count = <span class="number">0</span></span><br><span class="line">        <span class="comment"># convert the word list into a number list, 0 for unknown words</span></span><br><span class="line">        <span class="keyword">for</span> word <span class="keyword">in</span> words:</span><br><span class="line">            <span class="keyword">if</span> word <span class="keyword">in</span> dictionary:</span><br><span class="line">                index = dictionary[word]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                index = <span class="number">0</span></span><br><span class="line">                unk_count += <span class="number">1</span></span><br><span class="line">            data.append(index)</span><br><span class="line">        <span class="comment"># update the number of UNK</span></span><br><span class="line">        count[<span class="number">0</span>][<span class="number">1</span>] = unk_count</span><br><span class="line">        <span class="comment"># generate a new dictionary by exchanging key and value</span></span><br><span class="line">        reversed_dictionary = dict(zip(dictionary.values(), dictionary.keys()))</span><br><span class="line">        <span class="keyword">return</span> data, count, dictionary, reversed_dictionary</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># function to generate a training batch for the skip-gram model</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">generate_batch</span><span class="params">(self, data)</span>:</span></span><br><span class="line">        <span class="comment"># make sure the data length is OK</span></span><br><span class="line">        <span class="keyword">assert</span> self.batch_size % self.num_skips == <span class="number">0</span></span><br><span class="line">        <span class="keyword">assert</span> self.num_skips &lt;= <span class="number">2</span> * self.skip_window</span><br><span class="line"></span><br><span class="line">        batch = np.ndarray(shape=(self.batch_size), dtype=np.int32)</span><br><span class="line">        labels = np.ndarray(shape=(self.batch_size, <span class="number">1</span>), dtype=np.int32)</span><br><span class="line">        span = <span class="number">2</span> * self.skip_window + <span class="number">1</span>  <span class="comment"># [ skip_window target skip_window ]</span></span><br><span class="line">        <span class="comment"># create a new double-ended queue to store the buffer</span></span><br><span class="line">        buffer = collections.deque(maxlen=span)</span><br><span class="line">        <span class="comment"># data_index indicates the end point of the current window</span></span><br><span class="line">        <span class="keyword">if</span> self.data_index + span &gt; len(data):</span><br><span class="line">            data_index = <span class="number">0</span></span><br><span class="line">        buffer.extend(data[self.data_index:self.data_index + span])</span><br><span class="line">        self.data_index += span</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(self.batch_size // self.num_skips):</span><br><span class="line">            target = self.skip_window  <span class="comment"># target label at the center of the buffer</span></span><br><span class="line">            targets_to_avoid = [self.skip_window]</span><br><span class="line">            <span class="comment"># sample num_skips batches and labels, optimizable</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> range(self.num_skips):</span><br><span class="line">                <span class="keyword">while</span> target <span class="keyword">in</span> targets_to_avoid:</span><br><span class="line">                    target = random.randint(<span class="number">0</span>, span - <span class="number">1</span>)</span><br><span class="line">                <span class="comment"># avoid sampling to the same target</span></span><br><span class="line">                targets_to_avoid.append(target)</span><br><span class="line">                <span class="comment"># each batch item stands for input</span></span><br><span class="line">                batch[i * self.num_skips + j] = buffer[self.skip_window]</span><br><span class="line">                <span class="comment"># each label item stands for ground truth</span></span><br><span class="line">                labels[i * self.num_skips + j, <span class="number">0</span>] = buffer[target]</span><br><span class="line">            <span class="keyword">if</span> self.data_index == len(data):</span><br><span class="line">                buffer[:] = data[:span]</span><br><span class="line">                self.data_index = span</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                buffer.append(data[self.data_index])</span><br><span class="line">                self.data_index += <span class="number">1</span></span><br><span class="line">        <span class="comment"># Backtrack a little bit to avoid skipping words in the end of a batch</span></span><br><span class="line">        self.data_index = self.data_index - span</span><br><span class="line">        <span class="keyword">return</span> batch, labels</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">train</span><span class="params">(self, data, reverse_dictionary)</span>:</span></span><br><span class="line">        <span class="keyword">with</span> self.graph.as_default():</span><br><span class="line">            train_inputs = tf.placeholder(tf.int32, shape=[self.batch_size])</span><br><span class="line">            train_labels = tf.placeholder(tf.int32, shape=[self.batch_size, <span class="number">1</span>])</span><br><span class="line">            valid_dataset = tf.constant(self.valid_examples, dtype=tf.int32)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Ops and variables pinned to the CPU</span></span><br><span class="line">            <span class="keyword">with</span> tf.device(<span class="string">'/cpu:0'</span>):</span><br><span class="line">                <span class="comment"># Look up embeddings for inputs.</span></span><br><span class="line">                embeddings = tf.Variable(tf.random_uniform([self.vocabulary_size, self.embedding_size], <span class="number">-1.0</span>, <span class="number">1.0</span>))</span><br><span class="line">                <span class="comment"># according to embeddings, the 128-dimensional vector corresponding to the input word(train inputs) was extracted</span></span><br><span class="line">                embed = tf.nn.embedding_lookup(embeddings, train_inputs)</span><br><span class="line"></span><br><span class="line">                <span class="comment"># Construct the variables for the NCE loss</span></span><br><span class="line">                nce_weights = tf.Variable(tf.truncated_normal([self.vocabulary_size, self.embedding_size], stddev=<span class="number">1.0</span> / math.sqrt(self.embedding_size)))</span><br><span class="line">                nce_biases = tf.Variable(tf.zeros([self.vocabulary_size]))</span><br><span class="line">            <span class="comment"># Compute the average NCE loss for the batch.</span></span><br><span class="line">            <span class="comment"># tf.nce_loss automatically draws a new sample of the negative labels each</span></span><br><span class="line">            <span class="comment"># time we evaluate the loss.</span></span><br><span class="line">            loss = tf.reduce_mean(</span><br><span class="line">                tf.nn.nce_loss(weights=nce_weights,</span><br><span class="line">                             biases=nce_biases,</span><br><span class="line">                             labels=train_labels,</span><br><span class="line">                             inputs=embed,</span><br><span class="line">                             num_sampled=self.num_sampled,</span><br><span class="line">                             num_classes=self.vocabulary_size))</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># Construct the SGD optimizer using a learning rate of 1.0.</span></span><br><span class="line">            optimizer = tf.train.GradientDescentOptimizer(<span class="number">1.0</span>).minimize(loss)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Compute the cosine similarity between minibatch examples and all embeddings.</span></span><br><span class="line">            norm = tf.sqrt(tf.reduce_sum(tf.square(embeddings), <span class="number">1</span>, keep_dims=<span class="keyword">True</span>))</span><br><span class="line">            normalized_embeddings = embeddings / norm</span><br><span class="line">            valid_embeddings = tf.nn.embedding_lookup(normalized_embeddings, valid_dataset)</span><br><span class="line">            similarity = tf.matmul(valid_embeddings, normalized_embeddings, transpose_b=<span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># Add variable initializer.</span></span><br><span class="line">            init = tf.global_variables_initializer()</span><br><span class="line">            </span><br><span class="line">        <span class="keyword">with</span> tf.Session(graph = self.graph) <span class="keyword">as</span> session:</span><br><span class="line">            init.run()</span><br><span class="line">            average_loss = <span class="number">0</span></span><br><span class="line">            </span><br><span class="line">            <span class="keyword">for</span> step <span class="keyword">in</span> xrange(self.num_steps):</span><br><span class="line">                batch_inputs, batch_labels = self.generate_batch(data)</span><br><span class="line">                feed_dict = &#123;train_inputs: batch_inputs, train_labels: batch_labels&#125;</span><br><span class="line"></span><br><span class="line">                <span class="comment"># we perform one update step by evaluating the optimizer op (including it</span></span><br><span class="line">                <span class="comment"># in the list of returned values for session.run()</span></span><br><span class="line">                _, loss_val = session.run([optimizer, loss], feed_dict=feed_dict)</span><br><span class="line">                average_loss += loss_val</span><br><span class="line">                </span><br><span class="line">                <span class="keyword">if</span> step % <span class="number">2000</span> == <span class="number">0</span>:</span><br><span class="line">                    <span class="keyword">if</span> step &gt; <span class="number">0</span>:</span><br><span class="line">                        average_loss /= <span class="number">2000</span></span><br><span class="line">                    <span class="comment"># the average loss is an estimate of the loss over the last 2000 batches.</span></span><br><span class="line">                    print(<span class="string">'Average loss at step '</span>, step, <span class="string">': '</span>, average_loss)</span><br><span class="line">                    average_loss = <span class="number">0</span></span><br><span class="line">                </span><br><span class="line">                <span class="comment"># output the most similar eight words to the screen</span></span><br><span class="line">                <span class="keyword">if</span> step % <span class="number">10000</span> == <span class="number">0</span>:</span><br><span class="line">                    sim = similarity.eval()</span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> xrange(self.valid_size):</span><br><span class="line">                        valid_word = reverse_dictionary[self.valid_examples[i]]</span><br><span class="line">                        top_k = <span class="number">8</span>  <span class="comment"># number of nearest neighbors</span></span><br><span class="line">                        nearest = (-sim[i, :]).argsort()[<span class="number">1</span>:top_k + <span class="number">1</span>]</span><br><span class="line">                        log_str = <span class="string">'Nearest to %s:'</span> % valid_word</span><br><span class="line">                        <span class="keyword">for</span> k <span class="keyword">in</span> xrange(top_k):</span><br><span class="line">                            close_word = reverse_dictionary[nearest[k]]</span><br><span class="line">                            log_str = <span class="string">'%s %s,'</span> % (log_str, close_word)</span><br><span class="line">                        print(log_str)</span><br><span class="line">                        </span><br><span class="line">            self.final_embeddings = normalized_embeddings.eval()</span><br><span class="line">            </span><br><span class="line">    <span class="comment"># visualize the embeddings</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">plot_with_labels</span><span class="params">(self, low_dim_embs, labels, filename=<span class="string">'tsne.png'</span>)</span>:</span></span><br><span class="line">        <span class="keyword">assert</span> low_dim_embs.shape[<span class="number">0</span>] &gt;= len(labels), <span class="string">'More labels than embeddings'</span></span><br><span class="line">        plt.figure(figsize=(<span class="number">18</span>, <span class="number">18</span>))  <span class="comment"># in inches</span></span><br><span class="line">        <span class="keyword">for</span> i, label <span class="keyword">in</span> enumerate(labels):</span><br><span class="line">            x, y = low_dim_embs[i, :]</span><br><span class="line">            plt.scatter(x, y)</span><br><span class="line">            plt.annotate(label,</span><br><span class="line">                            xy=(x, y),</span><br><span class="line">                            xytext=(<span class="number">5</span>, <span class="number">2</span>),</span><br><span class="line">                            textcoords=<span class="string">'offset points'</span>,</span><br><span class="line">                            ha=<span class="string">'right'</span>,</span><br><span class="line">                            va=<span class="string">'bottom'</span>)</span><br><span class="line">        plt.show()</span><br><span class="line">        <span class="comment">#plt.savefig(filename)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        bpe = BasicPatternEmbedding()</span><br><span class="line">        filename = bpe.maybe_download(<span class="string">'text8.zip'</span>,<span class="number">31344016</span>)</span><br><span class="line">        vocabulary = bpe.read_data(filename)</span><br><span class="line">        print(<span class="string">'Data size'</span>, len(vocabulary))</span><br><span class="line">        <span class="keyword">print</span> (<span class="string">'vocabulary:'</span>, vocabulary[:<span class="number">10</span>])</span><br><span class="line">        </span><br><span class="line">        data, count, dictionary, reverse_dictionary = bpe.build_dataset(vocabulary)</span><br><span class="line">        <span class="keyword">del</span> vocabulary  <span class="comment"># Hint to reduce memory.</span></span><br><span class="line">        print(<span class="string">'Most common words (+UNK)'</span>, count[:<span class="number">5</span>])</span><br><span class="line">        print(<span class="string">'Sample data'</span>, data[:<span class="number">10</span>], [reverse_dictionary[i] <span class="keyword">for</span> i <span class="keyword">in</span> data[:<span class="number">10</span>]])</span><br><span class="line">        </span><br><span class="line">        batch, labels = bpe.generate_batch(data)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">            print(batch[i], reverse_dictionary[batch[i]], <span class="string">'-&gt;'</span>, labels[i, <span class="number">0</span>], reverse_dictionary[labels[i, <span class="number">0</span>]])</span><br><span class="line">        <span class="keyword">print</span> (dictionary[<span class="string">'a'</span>], dictionary[<span class="string">'as'</span>], dictionary[<span class="string">'term'</span>])</span><br><span class="line">        </span><br><span class="line">        bpe.train(data, reverse_dictionary)</span><br><span class="line">        </span><br><span class="line">        tsne = TSNE(perplexity=<span class="number">30</span>, n_components=<span class="number">2</span>, init=<span class="string">'pca'</span>, n_iter=<span class="number">5000</span>, method=<span class="string">'exact'</span>)</span><br><span class="line">        plot_only = <span class="number">300</span></span><br><span class="line">        low_dim_embs = tsne.fit_transform(bpe.final_embeddings[:plot_only, :])</span><br><span class="line"></span><br><span class="line">        labels = [reverse_dictionary[i] <span class="keyword">for</span> i <span class="keyword">in</span> xrange(plot_only)]</span><br><span class="line">        bpe.plot_with_labels(low_dim_embs, labels)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">except</span> ImportError:</span><br><span class="line">        print(<span class="string">'Please install sklearn, matplotlib, and scipy to show embeddings.'</span>)</span><br></pre></td></tr></table></figure>

<pre><code>Found and verified text8.zip
Data size 17005207
vocabulary: [&#39;anarchism&#39;, &#39;originated&#39;, &#39;as&#39;, &#39;a&#39;, &#39;term&#39;, &#39;of&#39;, &#39;abuse&#39;, &#39;first&#39;, &#39;used&#39;, &#39;against&#39;]
Most common words (+UNK) [[&#39;UNK&#39;, 2735459], (&#39;the&#39;, 1061396), (&#39;of&#39;, 593677), (&#39;and&#39;, 416629), (&#39;one&#39;, 411764)]
Sample data [0, 3081, 12, 6, 195, 2, 3134, 46, 59, 156] [&#39;UNK&#39;, &#39;originated&#39;, &#39;as&#39;, &#39;a&#39;, &#39;term&#39;, &#39;of&#39;, &#39;abuse&#39;, &#39;first&#39;, &#39;used&#39;, &#39;against&#39;]
3081 originated -&gt; 12 as
3081 originated -&gt; 0 UNK
12 as -&gt; 6 a
12 as -&gt; 3081 originated
6 a -&gt; 195 term
6 a -&gt; 12 as
195 term -&gt; 2 of
195 term -&gt; 6 a
6 12 195
Average loss at step  0 :  185.77481079101562
Nearest to it: confidence, doesn, theatre, came, gulf, cultural, sites, corps,
Nearest to use: buried, grave, observation, dust, batman, security, hungarian, opens,
Nearest to at: warrior, total, rivers, yards, reaction, extinction, exclusively, eu,
Nearest to if: emergency, present, developing, dates, life, for, pennsylvania, genesis,
Nearest to between: grant, execution, generally, power, official, interpreted, hiv, binary,
Nearest to people: unlikely, mainly, prussian, dedicated, shot, spending, dangerous, pick,
Nearest to states: forward, racing, begins, printed, follow, vacuum, study, mythology,
Nearest to by: rulers, protestant, marvel, republic, zero, letters, researchers, amiga,
Nearest to american: hit, stores, managed, practiced, intermediate, retrieved, moreover, unique,
Nearest to world: leadership, decay, culture, false, vii, et, dialogue, gave,
Nearest to but: denominations, passing, according, germans, medical, emperors, working, grant,
Nearest to an: removed, marxist, experts, ac, eugene, bones, tree, ne,
Nearest to were: coat, facing, grammar, storage, teach, covering, solomon, circuit,
Nearest to to: plant, supporting, pay, pp, shell, problem, acids, post,
Nearest to be: judah, photo, films, both, senate, woman, villages, eating,
Nearest to used: legislative, hero, private, organ, spaces, vice, top, trivia,
Average loss at step  2000 :  22.257665908694268
Average loss at step  4000 :  5.249317247629166
Average loss at step  6000 :  4.652066127896309
Average loss at step  8000 :  4.529780765414238
Average loss at step  10000 :  4.432040006399155
Nearest to it: he, came, votes, matters, doesn, whole, confidence, continues,
Nearest to use: alien, buried, security, hungarian, grave, dust, batman, amount,
Nearest to at: in, killed, appearance, extinction, mathbf, rivers, eu, pronunciation,
Nearest to if: life, molecules, emergency, dates, present, pennsylvania, for, rates,
Nearest to between: eight, execution, vs, of, hiv, grant, official, documentary,
Nearest to people: UNK, mainly, dedicated, selection, unlikely, shot, fact, dangerous,
Nearest to states: forward, racing, cover, arithmetic, study, vacuum, vs, begins,
Nearest to by: and, as, in, infant, co, manufacturer, with, campaign,
Nearest to american: hit, importance, austin, entry, depending, retrieved, vs, intermediate,
Nearest to world: culture, leadership, UNK, false, mathbf, skills, et, titled,
Nearest to but: and, medical, working, was, connecticut, vs, europeans, denominations,
Nearest to an: the, ac, plant, challenge, experts, necessary, lake, marxist,
Nearest to were: jpg, are, facing, covering, manual, circuit, opposite, test,
Nearest to to: ends, and, plant, in, office, into, supporting, agave,
Nearest to be: iso, shorter, judah, self, painter, also, dependent, assistance,
Nearest to used: opposition, hero, private, illinois, legislative, regime, breaking, repeated,</code></pre>
<p><img src="https://raw.githubusercontent.com/imonce/imgs/master/20191021100559.png"></p>
<h1 id="相关函数说明"><a href="#相关函数说明" class="headerlink" title="相关函数说明"></a>相关函数说明</h1><h2 id="Tensor-eval"><a href="#Tensor-eval" class="headerlink" title="Tensor.eval()"></a>Tensor.eval()</h2><p>.eval() 其实就是tf.Tensor的Session.run() 的另外一种写法，但两者有差别</p>
<ol>
<li>eval(): 将字符串string对象转化为有效的表达式参与求值运算返回计算结果</li>
<li>eval()也是启动计算的一种方式。基于Tensorflow的基本原理，首先需要定义图，然后计算图，其中计算图的函数常见的有run()函数，如sess.run()。同样eval()也是此类函数，</li>
<li>要注意的是，eval()只能用于tf.Tensor类对象，也就是有输出的Operation，写作Tensor.eval()。对于没有输出的Operation, 可以用.run()或者Session.run()；Session.run()没有这个限制。</li>
</ol>
<h2 id="np-argsort"><a href="#np-argsort" class="headerlink" title="np.argsort()"></a>np.argsort()</h2><p>argsort函数返回的是数组值从小到大的索引值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = np.array([<span class="number">3</span>, <span class="number">1</span>, <span class="number">2</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>np.argsort(x)</span><br><span class="line">array([<span class="number">1</span>, <span class="number">2</span>, <span class="number">0</span>])</span><br></pre></td></tr></table></figure>

<h2 id="tf-reduce-sum"><a href="#tf-reduce-sum" class="headerlink" title="tf.reduce_sum()"></a>tf.reduce_sum()</h2><p>reduce_sum( ) 是求和函数，在 tensorflow 里面，计算的都是 tensor，可以通过调整 axis =0,1 的维度来控制求和维度。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = tf.constant([[<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>],[<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>]])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tf.reduce_sum(x)</span><br><span class="line"><span class="number">6</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tf.reduce_sum(x, <span class="number">0</span>)</span><br><span class="line">[<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tf.reduce_sum(x, <span class="number">1</span>)</span><br><span class="line">[<span class="number">3</span>,<span class="number">3</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tf.reduce_sum(x, <span class="number">1</span>, keepdims=<span class="keyword">True</span>)</span><br><span class="line">[[<span class="number">3</span>],[<span class="number">3</span>]]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>tf.reduce_sum(x, [<span class="number">0</span>,<span class="number">1</span>])</span><br><span class="line"><span class="number">6</span></span><br></pre></td></tr></table></figure>

<h2 id="tf-nn-nce-loss"><a href="#tf-nn-nce-loss" class="headerlink" title="tf.nn.nce_loss()"></a>tf.nn.nce_loss()</h2><p>假设nce_loss之前的输入数据是K维的，一共有N个类，那么</p>
<p>weight.shape = (N, K)</p>
<p>bias.shape = (N)</p>
<p>inputs.shape = (batch_size, K)</p>
<p>labels.shape = (batch_size, num_true)</p>
<p>num_true : 实际的正样本个数</p>
<p>num_sampled: 采样出多少个负样本</p>
<p>num_classes = N</p>
<p>sampled_values: 采样出的负样本，如果是None，就会用不同的sampler去采样。待会儿说sampler是什么。</p>
<p>remove_accidental_hits: 如果采样时不小心采样到的负样本刚好是正样本，要不要干掉</p>
<p>partition_strategy：对weights进行embedding_lookup时并行查表时的策略。TF的embeding_lookup是在CPU里实现的，这里需要考虑多线程查表时的锁的问题</p>
<p>nce_loss的实现逻辑如下：</p>
<p>_compute_sampled_logits: 通过这个函数计算出正样本和采样出的负样本对应的output和label</p>
<p>sigmoid_cross_entropy_with_logits: 通过 sigmoid cross entropy来计算output和label的loss，从而进行反向传播。这个函数把最后的问题转化为了num_sampled+num_real个两类分类问题，然后每个分类问题用了交叉熵的损伤函数，也就是logistic regression常用的损失函数。TF里还提供了一个softmax_cross_entropy_with_logits的函数，和这个有所区别。</p>
<p>在训练过程中，作为input的embed也会被自动更新</p>
<h2 id="tf-nn-embedding-lookup"><a href="#tf-nn-embedding-lookup" class="headerlink" title="tf.nn.embedding_lookup()"></a>tf.nn.embedding_lookup()</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Signature:</span></span><br><span class="line">tf.nn.embedding_lookup(params, ids, partition_strategy=<span class="string">'mod'</span>, name=<span class="keyword">None</span>, validate_indices=<span class="keyword">True</span>, max_norm=<span class="keyword">None</span>)</span><br><span class="line"><span class="comment"># Docstring:</span></span><br><span class="line"><span class="comment"># Looks up `ids` in a list of embedding tensors.</span></span><br></pre></td></tr></table></figure>

<p>是根据 ids 中的id，寻找 params 中的第id行。比如 ids=[1,3,5]，则找出params中第1，3，5行，组成一个tensor返回。</p>
<p>embedding_lookup不是简单的查表，params 对应的向量是可以训练的，训练参数个数应该是 feature_num * embedding_size，即前文表述的embedding层权重矩阵，就是说 lookup 的是一种全连接层。</p>
<p>partition_strategy 为张量编号方式，在张量存在多维时起作用，编号的方式有两种，”mod”（默认） 和 “div”。</p>
<p>假设：一共有三个tensor [a,b,c] 作为params 参数，所有tensor的第 0 维上一共有 10 个项目（id 0 ~ 9）。</p>
<p>“mod” : (id) mod len(params) 得到 多少就把 id 分到第几个tensor里面</p>
<ul>
<li>a 依次分到id： 0 3 6 9</li>
<li>b 依次分到id： 1 4 7</li>
<li>c 依次分到id： 2 5 8</li>
</ul>
<p>“div” : (id) div len(params) 可以理解为依次排序，但是这两种切分方式在无法均匀切分的情况下都是将前(max_id+1)%len(params)个 partition 多分配一个元素.</p>
<ul>
<li>a 依次分到id： 0 1 2 3</li>
<li>b 依次分到id： 4 5 6</li>
<li>c 依次分到id： 7 8 9</li>
</ul>
<h2 id="tf-SparseTensor"><a href="#tf-SparseTensor" class="headerlink" title="tf.SparseTensor()"></a>tf.SparseTensor()</h2><p>构造稀疏向量矩阵，每一行为一个样本</p>
<p>SparseTensor(indices, values, dense_shape)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">SparseTensor(indices=[[<span class="number">0</span>, <span class="number">0</span>], [<span class="number">1</span>, <span class="number">2</span>]], values=[<span class="number">1</span>, <span class="number">2</span>], dense_shape=[<span class="number">3</span>, <span class="number">4</span>])</span><br><span class="line"></span><br><span class="line"><span class="comment"># represents the dense tensor</span></span><br><span class="line"></span><br><span class="line">[[<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]</span><br><span class="line"> [<span class="number">0</span>, <span class="number">0</span>, <span class="number">2</span>, <span class="number">0</span>]</span><br><span class="line"> [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>]]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>reference:<br><a href="https://blog.csdn.net/qoopqpqp/article/details/76037334" target="_blank" rel="noopener">https://blog.csdn.net/qoopqpqp/article/details/76037334</a><br><a href="https://segmentfault.com/a/1190000015287066?utm_source=tag-newest" target="_blank" rel="noopener">https://segmentfault.com/a/1190000015287066?utm_source=tag-newest</a><br><a href="https://blog.csdn.net/u012193416/article/details/83349138" target="_blank" rel="noopener">https://blog.csdn.net/u012193416/article/details/83349138</a><br><a href="https://blog.csdn.net/qq_36092251/article/details/79684721" target="_blank" rel="noopener">https://blog.csdn.net/qq_36092251/article/details/79684721</a><br><a href="https://gshtime.github.io/2018/06/01/tensorflow-embedding-lookup-sparse/" target="_blank" rel="noopener">https://gshtime.github.io/2018/06/01/tensorflow-embedding-lookup-sparse/</a></p>
</blockquote>

          
          
          
          
          
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="https://imonce.github.io/2019/10/10/一文读懂Curry-Howard同构/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/C_Meng.png">
      <meta itemprop="name" content="C_Meng">
      <meta itemprop="description" content="A stupid old man with a humble learning heart. And his dog.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="C_Meng PSNA">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/10/10/一文读懂Curry-Howard同构/" class="post-title-link" itemprop="url">一文读懂Curry-Howard同构</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-10-10 10:42:29" itemprop="dateCreated datePublished" datetime="2019-10-10T10:42:29+08:00">2019-10-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-11-04 14:01:07" itemprop="dateModified" datetime="2019-11-04T14:01:07+08:00">2019-11-04</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2019/10/10/一文读懂Curry-Howard同构/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/10/10/一文读懂Curry-Howard同构/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
          
          <h1 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h1><p>柯里-霍华德同构，Curry-Howard Isomorphism，又称柯里-霍华德对应（Curry-Howard correspondence）是在计算机程序和数学证明之间的紧密联系；这种对应也叫做公式为类型对应或命题为类型对应。这是对形式逻辑系统和公式计算（computational calculus）之间符号的相似性的推广。命名来自它的两位发现者：美国数学家哈斯凯尔·<strong>柯里</strong>和逻辑学家威廉·阿尔文·<strong>霍瓦德</strong>。</p>
<h1 id="同构对应"><a href="#同构对应" class="headerlink" title="同构对应"></a>同构对应</h1><p>Curry-Howard 同构显示了推理系统和程序语言之间的相似性，在此框架下：</p>
<ul>
<li>程序语言的语言构造同构为推理系统的推理规则</li>
<li>程序的类型同构为逻辑命题</li>
<li>闭合程序（不依赖环境的程序）可以同构为一条定理的证明过程，其类型就是一条定理</li>
<li>逻辑上下文同构为自由变量类型指派</li>
<li>Lambda 演算同构为 Gentzen 的自然演绎<ul>
<li>函数调用就是蕴含消除</li>
<li>函数抽象就是蕴含介入</li>
<li>参数多态就是全称量化</li>
<li>模板类型就是谓词</li>
<li>结构类型就是合取</li>
<li>联合类型就是析取</li>
<li>收参数但不返回就是否定</li>
<li>call/cc 就是双重否定消除</li>
</ul>
</li>
<li>SK 组合子演算同构为直觉 Hilbert 推理系统<ul>
<li>S 和 K 就是演算系统的两条公理</li>
</ul>
</li>
</ul>
<h1 id="Curry-Howard-同构与-Martin-Lof-类型论系统"><a href="#Curry-Howard-同构与-Martin-Lof-类型论系统" class="headerlink" title="Curry-Howard 同构与 Martin-Löf 类型论系统"></a>Curry-Howard 同构与 Martin-Löf 类型论系统</h1><p>这个框架里灵活性最高的是 Martin-Löf 的系统，两个高度抽象的算子—— $\prod$ 和 $\sum$ 进一步泛化了函数调用与合取，这使得它有极其恐怖的抽象能力。这个系统的推理规则是一下几条：</p>
<h2 id="Introduction-rule-for-prod"><a href="#Introduction-rule-for-prod" class="headerlink" title="Introduction rule for $\prod$"></a>Introduction rule for $\prod$</h2><p>$$\frac{\Gamma,x:A\vdash b:B}{\Gamma\vdash\lambda x.b:(\prod x:A)B}(\prod I)$$</p>
<h2 id="Elimination-rule-for-prod"><a href="#Elimination-rule-for-prod" class="headerlink" title="Elimination rule for $\prod$"></a>Elimination rule for $\prod$</h2><p>$$\frac{\Gamma\vdash f:(\prod x:A)B\quad\Gamma\vdash a:A}{\Gamma\vdash apply(f,a):B[a/x]}(\prod E)$$</p>
<p>Suppose $f = \lambda x.x$, then $apply(f,a)=(\lambda x.x)a$ </p>
<h2 id="Introduction-rule-for-sum"><a href="#Introduction-rule-for-sum" class="headerlink" title="Introduction rule for $\sum$"></a>Introduction rule for $\sum$</h2><p>$$\frac{\Gamma\vdash a:A\quad\Gamma\vdash b:B[a/x]}{\Gamma\vdash\lt a,b\gt:(\sum x:A)B}(\sum I)$$</p>
<h2 id="Elimination-rule-for-sum"><a href="#Elimination-rule-for-sum" class="headerlink" title="Elimination rule for $\sum$"></a>Elimination rule for $\sum$</h2><p>$$\frac{\Gamma\vdash c:(\sum x:A)B\quad\Gamma,x:A,y:B\vdash d:C[\lt x,y\gt/z]}{\Gamma\vdash split(c,\lambda x.\lambda y.d):C[c/z]}(\sum E)$$</p>
<p>where: $split(\lt a,b\gt,\lambda x.\lambda y.d)=(\lambda x.\lambda y.d)(a)(b)$ </p>
<blockquote>
<p>reference<br><a href="https://www.zhihu.com/question/22959608/answer/24770830" target="_blank" rel="noopener">https://www.zhihu.com/question/22959608/answer/24770830</a><br><a href="https://zh.wikipedia.org/zh-hans/%E6%9F%AF%E9%87%8C-%E9%9C%8D%E5%8D%8E%E5%BE%B7%E5%90%8C%E6%9E%84" target="_blank" rel="noopener">https://zh.wikipedia.org/zh-hans/柯里-霍华德同构</a><br><a href="http://www2.math.uu.se/~palmgren/tillog/klogik04-01eng.pdf" target="_blank" rel="noopener">http://www2.math.uu.se/~palmgren/tillog/klogik04-01eng.pdf</a></p>
</blockquote>

          
          
          
          
          
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="https://imonce.github.io/2019/09/27/Reading-Notes-Customer-Value-Chain-Analysis/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/C_Meng.png">
      <meta itemprop="name" content="C_Meng">
      <meta itemprop="description" content="A stupid old man with a humble learning heart. And his dog.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="C_Meng PSNA">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/09/27/Reading-Notes-Customer-Value-Chain-Analysis/" class="post-title-link" itemprop="url">[Reading Notes]Customer Value Chain Analysis</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-09-27 20:09:04" itemprop="dateCreated datePublished" datetime="2019-09-27T20:09:04+08:00">2019-09-27</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-01-04 15:59:21" itemprop="dateModified" datetime="2020-01-04T15:59:21+08:00">2020-01-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Reading-Notes/" itemprop="url" rel="index"><span itemprop="name">Reading Notes</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Reading-Notes/Service-Computing/" itemprop="url" rel="index"><span itemprop="name">Service Computing</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2019/09/27/Reading-Notes-Customer-Value-Chain-Analysis/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/09/27/Reading-Notes-Customer-Value-Chain-Analysis/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
          
          <h1 id="overall"><a href="#overall" class="headerlink" title="overall"></a>overall</h1><p>Customer Value Chain Analysis (CVCA) is an original methodological tool that enables design teams in the product definition phase to comprehensively identify pertinent stakeholders, their relationships with each other, and their role in the product’s life cycle.</p>
<h1 id="method"><a href="#method" class="headerlink" title="method"></a>method</h1><ol>
<li>CVCA Step 1: Determine the business model for the vending machine.</li>
<li>CVCA Step 2: Delineate pertinent parties involved with the vending machine’s life cycle.</li>
<li>CVCA Step 3: Determine how the vending machine’s customers are related to each other.</li>
<li>CVCA Step 4: Identify the value propositions of the vending machine’s customers and define the flows between them.</li>
<li>CVCA Step 5: Analyze the Customer Chain to determine the vending machine’s critical customers and their value propositions. The vending operator and the soft drink bottler (circled) were determined to be the critical customers to the vending machine manufacturer.</li>
</ol>
<p><img src="https://raw.githubusercontent.com/imonce/imgs/master/20190927200439.png"></p>
<h1 id="case-study"><a href="#case-study" class="headerlink" title="case study"></a>case study</h1><h2 id="Case-study-1-electrocardiogram-EKG-machine"><a href="#Case-study-1-electrocardiogram-EKG-machine" class="headerlink" title="Case study 1: electrocardiogram (EKG) machine"></a>Case study 1: electrocardiogram (EKG) machine</h2><p><img src="https://raw.githubusercontent.com/imonce/imgs/master/20190927200555.png"></p>
<h2 id="Case-study-2-pacemaker-alert-system"><a href="#Case-study-2-pacemaker-alert-system" class="headerlink" title="Case study 2: pacemaker alert system"></a>Case study 2: pacemaker alert system</h2><p><img src="https://raw.githubusercontent.com/imonce/imgs/master/20190927200646.png"></p>
<h2 id="Case-study-3-donor-funded-micro-irrigation-pump"><a href="#Case-study-3-donor-funded-micro-irrigation-pump" class="headerlink" title="Case study 3: donor-funded micro-irrigation pump"></a>Case study 3: donor-funded micro-irrigation pump</h2><p><img src="https://raw.githubusercontent.com/imonce/imgs/master/20190927200754.png"></p>

          
          
          
          
          
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="https://imonce.github.io/2019/09/23/Reading-Notes-Service-system-fundamentals-Work-system-value-chain-and-life-cycle/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/C_Meng.png">
      <meta itemprop="name" content="C_Meng">
      <meta itemprop="description" content="A stupid old man with a humble learning heart. And his dog.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="C_Meng PSNA">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/09/23/Reading-Notes-Service-system-fundamentals-Work-system-value-chain-and-life-cycle/" class="post-title-link" itemprop="url">[Reading Notes]Service system fundamentals: Work system, value chain, and life cycle</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-09-23 17:01:46" itemprop="dateCreated datePublished" datetime="2019-09-23T17:01:46+08:00">2019-09-23</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-01-04 15:59:38" itemprop="dateModified" datetime="2020-01-04T15:59:38+08:00">2020-01-04</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">In</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Reading-Notes/" itemprop="url" rel="index"><span itemprop="name">Reading Notes</span></a>
                </span>
                  , 
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Reading-Notes/Service-Computing/" itemprop="url" rel="index"><span itemprop="name">Service Computing</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2019/09/23/Reading-Notes-Service-system-fundamentals-Work-system-value-chain-and-life-cycle/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/09/23/Reading-Notes-Service-system-fundamentals-Work-system-value-chain-and-life-cycle/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
          
          <p>This paper presents three interrelated frameworks as a first attempt to define the fundamentals of service systems.</p>
<ul>
<li>The <strong>work system framework</strong> uses nine basic elements to provide a system-oriented view of any system that performs work within or across organizations. Service systems are work systems.<br><img src="https://raw.githubusercontent.com/imonce/imgs/master/20190923165345.png"></li>
<li>The <strong>service value chain framework</strong> augments the work system framework by introducing functions that are associated specifically with services. It presents a two-sided view of service processes based on the common observation that services are typically coproduced by service providers and customers.<br><img src="https://raw.githubusercontent.com/imonce/imgs/master/20190923165509.png"></li>
<li>The <strong>work system life cycle model</strong> looks at how work systems (including service systems) change and evolve over time. It treats the life cycle of a system as a set of iterations involving planned and unplanned change.<br><img src="https://raw.githubusercontent.com/imonce/imgs/master/20190923165759.png"></li>
</ul>
<p>This paper uses two examples, one largely manual and one highly automated, to illustrate the potential usefulness of the three frameworks, which can be applied together to describe, analyze, and study how service systems are created, how they operate, and how they evolve through a combination of planned and unplanned change.</p>
<p><img src="https://raw.githubusercontent.com/imonce/imgs/master/20190923165943.png"></p>
<p><img src="https://raw.githubusercontent.com/imonce/imgs/master/20190923170026.png"></p>

          
          
          
          
          
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="https://imonce.github.io/2019/09/19/BPMN2-0入门到精通，这一篇就够了/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/C_Meng.png">
      <meta itemprop="name" content="C_Meng">
      <meta itemprop="description" content="A stupid old man with a humble learning heart. And his dog.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="C_Meng PSNA">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/09/19/BPMN2-0入门到精通，这一篇就够了/" class="post-title-link" itemprop="url">BPMN2.0入门到掌握，这一篇就够了</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-09-19 10:54:24" itemprop="dateCreated datePublished" datetime="2019-09-19T10:54:24+08:00">2019-09-19</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-11-04 14:01:26" itemprop="dateModified" datetime="2019-11-04T14:01:26+08:00">2019-11-04</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2019/09/19/BPMN2-0入门到精通，这一篇就够了/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/09/19/BPMN2-0入门到精通，这一篇就够了/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
          
          <p>BPMN2.0入门到精通，这一篇就够了</p>
<p>笔者默认看这篇文章的同学都是了解、知道什么是BPMN的，因此背景知识、历史发展什么的都直接略过，我们直切正题：BPMN中的五个基础元素类别。</p>
<ol>
<li>流对象（Flow Objects）：流对象是定义业务流程的主要图形元素，主要有三种流对象<ol>
<li>事件（Events）</li>
<li>活动（Activities）</li>
<li>网关（Gateways）</li>
</ol>
</li>
<li>数据（Data）：数据主要通过四种元素表示<ol>
<li>数据对象（Data Objects）</li>
<li>数据输入（Data Inputs）</li>
<li>数据输出（Data Outputs）</li>
<li>数据存储（Data Stores）</li>
</ol>
</li>
<li>连接对象（Connecting Objects）：流对象彼此互相连接或者连接到其他信息的方法主要有四种<ol>
<li>顺序流（Sequence Flows）</li>
<li>信息流（Message Flows）</li>
<li>协同（Associations）</li>
<li>数据协同（Data Associations）</li>
</ol>
</li>
<li>泳道（Swimlanes）：有两种方式通过泳道对主要的建模元素进行分组<ol>
<li>泳池：Pools</li>
<li>泳道：Lanes</li>
</ol>
</li>
<li>Artifacts：主要用来提供关于流程的额外信息。BPMN2.0定义两种标准Artifacts，但是建模者或者建模工具可以增加任意多Artifacts。（Artifacts，有的地方翻译成“工件”，但是感觉不管翻译成什么都不够传神，所以本文中就不翻译这个词了。）<ol>
<li>组：Group</li>
<li>文本注释：Text Annotation</li>
</ol>
</li>
</ol>
<h1 id="流对象（Flow-Objects）"><a href="#流对象（Flow-Objects）" class="headerlink" title="流对象（Flow Objects）"></a>流对象（Flow Objects）</h1><h2 id="事件（Event）"><a href="#事件（Event）" class="headerlink" title="事件（Event）"></a>事件（Event）</h2><table>
<thead>
<tr>
<th align="left">元素 Element</th>
<th align="left">描述 Description</th>
<th align="left">符号 Notation</th>
</tr>
</thead>
<tbody><tr>
<td align="left">开始事件 Start</td>
<td align="left">表示一个流程(Process)或一个编排(choreography)的开始</td>
<td align="left"><img src="https://raw.githubusercontent.com/imonce/imgs/master/20190918171605.png"></td>
</tr>
<tr>
<td align="left">中间事件 Intermediate</td>
<td align="left">发生在开始和结束事件之间，影响处理流程</td>
<td align="left"><img src="https://raw.githubusercontent.com/imonce/imgs/master/20190918171742.png"></td>
</tr>
<tr>
<td align="left">结束事件 End</td>
<td align="left">表示一个流程(Process)或一个编排(choreography)的结束</td>
<td align="left"><img src="https://raw.githubusercontent.com/imonce/imgs/master/20190918205755.png"></td>
</tr>
<tr>
<td align="left">其他</td>
<td align="left">开始事件和一些中间事件具有定义事件原因的“触发器”。结束事件可以定义作为序列流路径结束的“结果”。开始事件只能对触发器（“catch”）做出反应。结束事件只能创建（“抛出”）结果。中间事件可以捕获或抛出触发器。对于捕获的事件、触发器，标记未填充；对于抛出的触发器和结果，标记已填充。另外，在bpmn 1.1中用来中断活动的一些事件现在可以在不中断的模式下使用。这些事件的边界是虚线（见右图）。</td>
<td align="left"><img src="https://raw.githubusercontent.com/imonce/imgs/master/20190918210944.png"></td>
</tr>
</tbody></table>
<h2 id="活动（Activity）"><a href="#活动（Activity）" class="headerlink" title="活动（Activity）"></a>活动（Activity）</h2><table>
<thead>
<tr>
<th align="left">元素 Element</th>
<th align="left">描述 Description</th>
<th align="left">符号 Notation</th>
</tr>
</thead>
<tbody><tr>
<td align="left">活动 Activity</td>
<td align="left">活动是公司在流程中执行的工作的通用术语。活动可以是原子的或非原子的（聚合物）。作为流程模型一部分的活动类型有：子流程和任务，它们都是圆角矩形。活动用于标准流程Process和编排Choreography。</td>
<td align="left"><img src="https://raw.githubusercontent.com/imonce/imgs/master/20190918212024.png"></td>
</tr>
<tr>
<td align="left">任务（原子） Task（atomic）</td>
<td align="left">任务是包含在流程中的原子活动。任务是当流程中的工作无法分解为更精细的流程细节级别时使用。</td>
<td align="left"><img src="https://raw.githubusercontent.com/imonce/imgs/master/20190918212345.png"></td>
</tr>
<tr>
<td align="left">编排任务 Choreography Task</td>
<td align="left">表示一个或多个消息交换的集合。每个编排任务涉及两个参与者。</td>
<td align="left"><img src="https://raw.githubusercontent.com/imonce/imgs/master/20190918213005.png"></td>
</tr>
<tr>
<td align="left">子流程 Sub-Process</td>
<td align="left">子流程是包含在流程或编排中的复合活动。它是复合的，因为它可以通过一组子活动分解为更细粒度级别的流程或编排。子流程活动主要有以下四类</td>
<td align="left">Collapsed Sub-Process<img src="https://raw.githubusercontent.com/imonce/imgs/master/20190918213352.png">Expanded Sub-Process<img src="https://raw.githubusercontent.com/imonce/imgs/master/20190918213453.png">Collapsed Sub- Choreography<img src="https://raw.githubusercontent.com/imonce/imgs/master/20190918213530.png">Expanded Sub-Choreography<img src="https://raw.githubusercontent.com/imonce/imgs/master/20190918213637.png"></td>
</tr>
</tbody></table>
<h2 id="网关（Gateway）"><a href="#网关（Gateway）" class="headerlink" title="网关（Gateway）"></a>网关（Gateway）</h2><table>
<thead>
<tr>
<th align="left">元素 Element</th>
<th align="left">描述 Description</th>
<th align="left">符号 Notation</th>
</tr>
</thead>
<tbody><tr>
<td align="left">网关 Gateway</td>
<td align="left">网关用于顺序流程和编排中序列流的发散和收敛。因此，它将决定路径的分支、分叉、合并和连接。内部标记将指示行为控制的类型（见下边一行）。</td>
<td align="left"><img src="https://raw.githubusercontent.com/imonce/imgs/master/20190918214000.png"></td>
</tr>
<tr>
<td align="left">网关控制类型 Gateway Control Type</td>
<td align="left">网关菱形内的图标将指示流控制行为的类型。控制类型包括：•排他型exclusive决策和合并。排他型exclusive和基于事件event-based的网关都执行排他决策，合并排他可以使用或不使用“x”标记来显示。•基于事件event-based和基于并行事件parallel event-based的网关可以启动流程的新实例。•包容型inclusive网关决策和合并。•复杂型complex网关——复杂的条件和情况。•并行parallel网关分叉和连接。每种类型的控件都会影响传入和传出流。</td>
<td align="left"><img src="https://raw.githubusercontent.com/imonce/imgs/master/20190918214411.png"></td>
</tr>
</tbody></table>
<h1 id="数据（Data）"><a href="#数据（Data）" class="headerlink" title="数据（Data）"></a>数据（Data）</h1><p>数据对象提供有关需要执行的活动和/或它们产生的内容的信息，数据对象可以表示单个数据对象或数据对象集合。数据输入和数据输出为流程提供相同的信息。</p>
<p><img src="https://raw.githubusercontent.com/imonce/imgs/master/20190919100053.png"></p>
<h1 id="连接对象（Connecting-Objects）"><a href="#连接对象（Connecting-Objects）" class="headerlink" title="连接对象（Connecting Objects）"></a>连接对象（Connecting Objects）</h1><table>
<thead>
<tr>
<th align="left">元素 Element</th>
<th align="left">描述 Description</th>
<th align="left">符号 Notation</th>
</tr>
</thead>
<tbody><tr>
<td align="left">顺序流 Sequence Flow</td>
<td align="left">表示活动的执行顺序</td>
<td align="left"><img src="https://raw.githubusercontent.com/imonce/imgs/master/20190919100734.png"></td>
</tr>
<tr>
<td align="left">信息流 Message Flow</td>
<td align="left">表示两个参与者之间准备发送和接收的信息流</td>
<td align="left"><img src="https://raw.githubusercontent.com/imonce/imgs/master/20190919100958.png"></td>
</tr>
<tr>
<td align="left">协同 Association</td>
<td align="left">协同用于将信息和artifact与图形元素链接。如果有箭头，则表示流向（如数据）。</td>
<td align="left"><img src="https://raw.githubusercontent.com/imonce/imgs/master/20190919101435.png"></td>
</tr>
</tbody></table>
<h1 id="泳道（Swimlanes）"><a href="#泳道（Swimlanes）" class="headerlink" title="泳道（Swimlanes）"></a>泳道（Swimlanes）</h1><table>
<thead>
<tr>
<th align="left">元素 Element</th>
<th align="left">描述 Description</th>
<th align="left">符号 Notation</th>
</tr>
</thead>
<tbody><tr>
<td align="left">泳池 Pool</td>
<td align="left">泳池是协作中参与者的图形表示。它还充当一个“泳道”和一个图形容器，用于从其他池中分割一组活动，通常是在B2B环境中。泳池可以具有内部详细信息，以将要执行的进程的形式显示。或者一个泳池可能没有内部细节，也就是说，它可以是一个“黑匣子”。</td>
<td align="left"><img src="https://raw.githubusercontent.com/imonce/imgs/master/20190919102300.png"></td>
</tr>
<tr>
<td align="left">泳道 Lane</td>
<td align="left">lane是进程中的一个子分区，有时在泳池中，它将垂直或水平地扩展进程的整个长度。泳道用于组织和分类活动。</td>
<td align="left"><img src="https://raw.githubusercontent.com/imonce/imgs/master/20190919102427.png"></td>
</tr>
</tbody></table>
<h1 id="Artifacts"><a href="#Artifacts" class="headerlink" title="Artifacts"></a>Artifacts</h1><table>
<thead>
<tr>
<th align="left">元素 Element</th>
<th align="left">描述 Description</th>
<th align="left">符号 Notation</th>
</tr>
</thead>
<tbody><tr>
<td align="left">组 Group</td>
<td align="left">组是同一类别内的图形元素的组。这种类型的分组不影响组内的序列流。类别名称在关系图上显示为组标签。类别可用于文档或分析目的。组是可以在图表上直观显示对象类别的一种方式。</td>
<td align="left"><img src="https://raw.githubusercontent.com/imonce/imgs/master/20190919102731.png"></td>
</tr>
<tr>
<td align="left">文本注释 Text Annotation</td>
<td align="left">是一个帮助建模者给图形元素增加额外文本说明的机制。</td>
<td align="left"><img src="https://raw.githubusercontent.com/imonce/imgs/master/20190919102837.png"></td>
</tr>
</tbody></table>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>至此，你已经通过 <strong>20%</strong> 的时间了解了BPMN2.0 接近 <strong>80%</strong> 的内容。虽然BPMN底层语法以及结构还没有学习，但是这并不影响你已经可以通过BPMN2.0对你所在的业务进行详尽的描述！</p>

          
          
          
          
          
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="https://imonce.github.io/2019/09/02/WhatIs-Definition-Theorem-Lemma-Corollary-Proposition-Conjecture-Claim-Axiom-Postulate-Identity-and-Paradox/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/C_Meng.png">
      <meta itemprop="name" content="C_Meng">
      <meta itemprop="description" content="A stupid old man with a humble learning heart. And his dog.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="C_Meng PSNA">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/09/02/WhatIs-Definition-Theorem-Lemma-Corollary-Proposition-Conjecture-Claim-Axiom-Postulate-Identity-and-Paradox/" class="post-title-link" itemprop="url">WhatIs: Definition, Theorem, Lemma, Corollary, Proposition, Conjecture, Claim, Axiom, Postulate, Identity, and Paradox</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              

              <time title="Created: 2019-09-02 20:49:18 / Modified: 20:54:34" itemprop="dateCreated datePublished" datetime="2019-09-02T20:49:18+08:00">2019-09-02</time>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2019/09/02/WhatIs-Definition-Theorem-Lemma-Corollary-Proposition-Conjecture-Claim-Axiom-Postulate-Identity-and-Paradox/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/09/02/WhatIs-Definition-Theorem-Lemma-Corollary-Proposition-Conjecture-Claim-Axiom-Postulate-Identity-and-Paradox/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
          
          <h1 id="Definition（定义）"><a href="#Definition（定义）" class="headerlink" title="Definition（定义）"></a>Definition（定义）</h1><p>A precise and unambiguous description of the meaning of a mathematical term. It characterizes the meaning of a word by giving all the properties and only those properties that must be true.</p>
<p>对数学术语含义的精确而明确的描述。它通过给出一个词的所有性质，仅给出那些必须为真的性质，来表征该词的意义。</p>
<h1 id="Theorem（定理）"><a href="#Theorem（定理）" class="headerlink" title="Theorem（定理）"></a>Theorem（定理）</h1><p>A mathematical statement that is proved using rigorous mathematical reasoning. In a mathematical paper, the term theorem is often reserved for the most important results.</p>
<p>用严格的数学推理证明的数学陈述。在数学论文中，术语定理通常是为最重要的结果而保留的。</p>
<h1 id="Lemma（引理）"><a href="#Lemma（引理）" class="headerlink" title="Lemma（引理）"></a>Lemma（引理）</h1><p>A minor result whose sole purpose is to help in proving a theorem. It is a stepping stone on the path to proving a theorem. Very occasionally lemmas can take on a life of their own.</p>
<p>唯一目的是帮助证明定理的小结果。这是证明一个定理之路的踏脚石。极少情况下引理可以独立存在。</p>
<h1 id="Corollary（推论）"><a href="#Corollary（推论）" class="headerlink" title="Corollary（推论）"></a>Corollary（推论）</h1><p>A result in which the (usually short) proof relies heavily on a given theorem (we often say that “this is a corollary of Theorem A”).</p>
<p>证明（通常是简短的）很大程度上依赖于一个给定定理的结果（我们经常说“这是定理A的一个推论”）。</p>
<h1 id="Proposition（命题）"><a href="#Proposition（命题）" class="headerlink" title="Proposition（命题）"></a>Proposition（命题）</h1><p>A proved and often interesting result, but generally less important than a theorem.</p>
<p>一个被证明的，通常很有趣的结果，但一般没有定理重要。</p>
<h1 id="Conjecture（推测，猜想）"><a href="#Conjecture（推测，猜想）" class="headerlink" title="Conjecture（推测，猜想）"></a>Conjecture（推测，猜想）</h1><p>A statement that is unproved, but is believed to be true.</p>
<h1 id="Claim（断言）"><a href="#Claim（断言）" class="headerlink" title="Claim（断言）"></a>Claim（断言）</h1><p>An assertion that is then proved. It is often used like an informal lemma.</p>
<p>未经证实但被认为是真实的陈述。</p>
<h1 id="Axiom-Postulate（公理-假定）"><a href="#Axiom-Postulate（公理-假定）" class="headerlink" title="Axiom/Postulate（公理/假定）"></a>Axiom/Postulate（公理/假定）</h1><p>A statement that is assumed to be true without proof. These are the basic building blocks from which all theorems are proved.</p>
<p>没有证明，且假设为真的陈述。这些是证明所有定理的基本构造块。</p>
<h1 id="Identity（恒等式）"><a href="#Identity（恒等式）" class="headerlink" title="Identity（恒等式）"></a>Identity（恒等式）</h1><p>A mathematical expression giving the equality of two (often variable) quantities.</p>
<p>两个（通常是可变的）量相等的数学表达式。</p>
<h1 id="Paradox（悖论）"><a href="#Paradox（悖论）" class="headerlink" title="Paradox（悖论）"></a>Paradox（悖论）</h1><p>A statement that can be shown, using a given set of axioms and de nitions, to be both true and false. Paradoxes are often used to show the  inconsistencies in an awed theory. The term paradox is often used informally to describe a surprising or counterintuitive result that follows from a given set of rules. </p>
<p>一种使用一组给定的公理和定义，既正确又错误的陈述。悖论经常被用来显示敬畏理论中的矛盾。“悖论”一词通常被非正式地用来描述从一组给定规则得出的令人惊讶或违反直觉的结果。</p>

          
          
          
          
          
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="https://imonce.github.io/2019/08/28/一个案例讲清楚所有服务盈利模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/C_Meng.png">
      <meta itemprop="name" content="C_Meng">
      <meta itemprop="description" content="A stupid old man with a humble learning heart. And his dog.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="C_Meng PSNA">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/28/一个案例讲清楚所有服务盈利模式/" class="post-title-link" itemprop="url">一个案例讲清楚所有服务盈利模式</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-08-28 13:46:28" itemprop="dateCreated datePublished" datetime="2019-08-28T13:46:28+08:00">2019-08-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2019-11-04 14:01:38" itemprop="dateModified" datetime="2019-11-04T14:01:38+08:00">2019-11-04</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2019/08/28/一个案例讲清楚所有服务盈利模式/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/08/28/一个案例讲清楚所有服务盈利模式/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
          
          <h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>互联网发展到今天，各种各样的互联网公司、互联网服务层出不穷，盈利方式更是”千奇百怪“，免费服务更是数不胜数，已然成为一种常态。</p>
<p>然而众所周知，无利不起早，是人就要吃饭。虽然我们享受着众多”免费“服务、点着各种满减外卖，但是这些提供服务的公司和平台却都活的好好的。他们的服务盈利模式都有哪些呢？</p>
<h1 id="服务盈利模式"><a href="#服务盈利模式" class="headerlink" title="服务盈利模式"></a>服务盈利模式</h1><p>服务盈利模式总的来说分为两大类：内向盈利模式和外向盈利模式。</p>
<ul>
<li>内向盈利模式：利润来自于服务提供者或消费者，依赖于在服务过程中产生或剩余的价值的盈利模式。</li>
<li>外向盈利模式：利润来自于无关自三方，依赖于服务存在的盈利模式。</li>
</ul>
<p>根据变现对象的不同，内向盈利模式和外向盈利模式又可以分为以下几种子模式：</p>
<ul>
<li>内向盈利模式<ul>
<li>资产盈利模式：通过资产换取价值的盈利模式，如资产销售</li>
<li>服务盈利模式：依赖资产，通过提供服务换取价值的盈利模式，如收费服务、增值服务</li>
<li>平台盈利模式（内向型）：通过平台换取价值的盈利模式，如押金池、管理费</li>
<li>过程盈利模式（内向型）：依赖平台，通过服务过程产生额外价值的盈利模式，如佣金抽成</li>
</ul>
</li>
<li>外向盈利模式<ul>
<li>平台盈利模式（外向型）：依赖平台，从无关第三方获取价值的盈利方式，如金融运作</li>
<li>过程盈利模式（外向型）：依赖过程，从无关第三方获取价值的盈利方式，如广告</li>
<li>其他盈利模式：通过吸引投资、上市募集资金等手段获取价值的盈利方式，如外部投资</li>
</ul>
</li>
</ul>
<p><img src="https://raw.githubusercontent.com/imonce/imgs/master/20190827225719.png"></p>
<h1 id="案例讲解"><a href="#案例讲解" class="headerlink" title="案例讲解"></a>案例讲解</h1><p>我们现在虚构一个案例来讲解一下这几种盈利模式：</p>
<p>假设现在是2000年，有一家公司叫阿里后妈，他们是一个传统的服饰售卖公司。</p>
<p>由于互联网兴起，他们为了能够在线上销售自己的衣服，搭建了一个线上购物网站，通过销售一些货品获得盈利，此时他们的盈利模式是<strong>资产盈利模式</strong>。</p>
<p>为了增加客户黏度，他们提出了会员制度，通过办理线上会员，客户可以享受优先发货、免费退换等增值服务。此举一出，客户疯狂办理会员，后妈发现，衣服可以不赚钱，就交个朋友，会员费就够自己发工资了，此时他们的盈利模式是<strong>服务盈利模式</strong>。</p>
<p>阿里后妈的平台上人越来越多，这使得一些友商蠢蠢欲动。他们纷纷找阿里后妈商谈业务，希望能把自己的商品也上架到阿里后妈的网站上，他们愿意按期交一些管理费。后妈发现，自己连衣服都不用卖了，收管理费就足够恰饭了。此时盈利模式是<strong>平台盈利模式（内向型）</strong>。</p>
<p>但是一段时间过后，因为交易量大涨，导致平台运营成本增加，后妈发现每个月收的那点管理费有点不够用了。而且不管卖的多卖的少，商家交的管理费都一样，这是不公平的。于是后妈开始在管理费之外，每一单交易都收取30%的抽成。于是又增加了一种盈利模式<strong>过程盈利模式（内向型）</strong>。</p>
<p>员工越来越多、工资越来越高，交易量增速却开始下降，后妈发现这样下去可能要恰不起饭了。但是目前30%的抽成已经够高了，管理费用签过合同短期内不能变，怎么增加收入呢？后妈想到平台上有很多的押金，以及大量交易时的中转滞留滞留的资金，从中拿一部分出来，在不影响平台正常运作的情况下，做一些收益稳定的投资。盈利模式增加了<strong>平台盈利模式（外向型）</strong>。</p>
<p>过了一段时间，某离职员工把公司私用用户资金的问题爆料了出来，金融运作的路子走不通了。后妈又想到，可以在用户交易的过程中增加广告，比如交易页面上增加一个广告条，按照广告的播放次数收费，不需要增加买家或者卖家的成本，可以直接从第三方获取收益，岂不美哉。盈利模式增加了一种<strong>过程盈利模式（外向型）</strong>。</p>
<p>公司越办越大，最终上市，大量资金涌入，各个机构的投资纷至沓来，这些钱和服务并没有关系，这部分盈利属于<strong>其他盈利模式</strong>。</p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>一家互联网公司同一时期并非只能存在一种盈利模式，通常情况下，是多种盈利模式共存的。</p>
<p>本问提出的划分方法，第一层是通过盈利来源来分（内部、外部），第二层是通过利润的产生对象来分（资产、服务、平台、过程），对于服务盈利模式进行了较好的抽象，对目前常见的盈利模式由较好的覆盖。</p>

          
          
          
          
          
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="default">
    <link itemprop="mainEntityOfPage" href="https://imonce.github.io/2019/08/21/构造类型论简介/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/C_Meng.png">
      <meta itemprop="name" content="C_Meng">
      <meta itemprop="description" content="A stupid old man with a humble learning heart. And his dog.">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="C_Meng PSNA">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2019/08/21/构造类型论简介/" class="post-title-link" itemprop="url">[Reading Note]构造类型论与计算机程序设计</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>

              <time title="Created: 2019-08-21 15:53:08" itemprop="dateCreated datePublished" datetime="2019-08-21T15:53:08+08:00">2019-08-21</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">Edited on</span>
                <time title="Modified: 2020-02-23 15:02:39" itemprop="dateModified" datetime="2020-02-23T15:02:39+08:00">2020-02-23</time>
              </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine: </span>
    
    <a title="valine" href="/2019/08/21/构造类型论简介/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2019/08/21/构造类型论简介/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          
          
          <blockquote>
<p>Taken from：<br><a href="http://xueshu.baidu.com/usercenter/paper/show?paperid=baa0175c22e30823d9b1e14e01cf4141&amp;site=xueshu_se&amp;hitarticle=1" target="_blank" rel="noopener">http://xueshu.baidu.com/usercenter/paper/show?paperid=baa0175c22e30823d9b1e14e01cf4141&amp;site=xueshu_se&amp;hitarticle=1</a></p>
</blockquote>
<h1 id="背景及简介"><a href="#背景及简介" class="headerlink" title="背景及简介"></a>背景及简介</h1><p>构造类型论为计算机科学家提供了一个框架, 以一种优雅和灵活的方式把逻辑和程序设计语言结合起来: 在同一形式系统中, 可以同时表达规约和(函数式语言)程序, 从证明规则可以导出正确的程序, 并验证程序具有某种性质, 从而在同一系统内完成程序的开发和验证。</p>
<h2 id="构造类型轮的理论基础及相互关系"><a href="#构造类型轮的理论基础及相互关系" class="headerlink" title="构造类型轮的理论基础及相互关系"></a>构造类型轮的理论基础及相互关系</h2><h3 id="构造类型论三大理论基石"><a href="#构造类型论三大理论基石" class="headerlink" title="构造类型论三大理论基石"></a>构造类型论三大理论基石</h3><ul>
<li>直觉类型论和构造数学：构造类型论的直接基础是Martin-Lof的直觉类型论，它为构造数学提供直觉解释。它是一个逻辑框架，可以表达和解释其他逻辑或理论，从他的规范化证明立即得出其所表达理论的规范化。与此作用相同的还有T.Coquand和Giared的构造演算。</li>
<li>lambda演算和函数式语言程序设计与实现。lambda演算是函数式语言理论的基础，是函数式程序设计语言的纯理论部分的范式(canonical form)，是由函数抽象和函数应用组成的系统，而这两个特点也是程序设计语言所具有的的共同之处。</li>
<li>证明论和Curry-Howard同态。证明轮中直觉注意逻辑的Gentzen自然演绎、一些自动演绎技术及定理证明技术是构造类型轮实现系统主要使用的技术。</li>
</ul>
<h3 id="相互关系"><a href="#相互关系" class="headerlink" title="相互关系"></a>相互关系</h3><p>Curry-Howard同态是Martin-Lof直觉类型轮的基础：把命题解释称类型（propositions-a-types），或命题作为集合（propositions=as=sets）。利用命题与集合之间的等价，推导的规范化与计算机表示该推导的证明项的值对应。</p>
<p>直觉主义（构造）逻辑和有类型lambda演算在Curry-Howard同态下可以相互转化：直觉逻辑自然演绎的证明可用某种有类型lambda项表示，并且自然演绎的证明规范化与lambda演算的beta变换对应。</p>
<p><img src="https://raw.githubusercontent.com/imonce/imgs/master/20190822150526.png"></p>
<h2 id="构造类型轮与程序设计的对应关系"><a href="#构造类型轮与程序设计的对应关系" class="headerlink" title="构造类型轮与程序设计的对应关系"></a>构造类型轮与程序设计的对应关系</h2><p>构造数学和计算机科学有一些基本概念是共同的。Bishop认为构造数学可以作为计算机科学的灵感的重要来源。</p>
<h3 id="构造性证明与计算机程序概念的关系"><a href="#构造性证明与计算机程序概念的关系" class="headerlink" title="构造性证明与计算机程序概念的关系"></a>构造性证明与计算机程序概念的关系</h3><p>构造性的证明与计算机程序概念有密切关系：为构造地证明命题 $(\forall x \in A)(\exists y \in B)P(x,y)$ ，必须要给出函数f，使f应用于A中元素a时，产生B中元素b，使P(a,b)满足。如果P(a,b)描述了一个规约，则证明该命题的函数f就是满足该规约的一个程序。所以，可以吧构造证明本身看成是一个计算机程序，程序的计算过程与证明的规范化对应。正因为构造性证明的这一计算内容，可把类型轮用作一种程序设计语言，而且，由于程序是从他的说明的证明中得到的，类型轮还可以用作程序设计逻辑。</p>
<h3 id="Martin-Lof直觉类型论和计算机程序概念的关系"><a href="#Martin-Lof直觉类型论和计算机程序概念的关系" class="headerlink" title="Martin-Lof直觉类型论和计算机程序概念的关系"></a>Martin-Lof直觉类型论和计算机程序概念的关系</h3><p>类型轮不是基于谓词逻辑，它不再使用Tarski的真值语义，而是利用命题和集合之间的Curry-Howard同态——“命题作为集合”的直觉主义语义来解释逻辑常数。这里，命题被解释称一个集合，若他的元素则被解释称命题的一个证明。根据Kolmogorov对直觉命题的解释，还可以吧集合看成是问题的描述，尤其是把集合看成是程序要解决问题的规约时，集合的元素就是满足该规约的程序。</p>
<p><img src="https://raw.githubusercontent.com/imonce/imgs/master/20190822151629.png"></p>
<p>用类型轮进行程序构造的好处是，可以在同一形式系统中表达规约和程序。同时，因为可以从证明规则到处正确的程序，并验证程序具有的性质，所以程序开发的验证也是在同一系统用中完成的。</p>
<h2 id="构造类型轮的一些实现"><a href="#构造类型轮的一些实现" class="headerlink" title="构造类型轮的一些实现"></a>构造类型轮的一些实现</h2><p>类型论的一个主要应用是作为变成逻辑，在其中能够从规约推导出程序。近年来，有几种类型轮的实现：</p>
<ol>
<li>Conell大学的Nurpl</li>
<li>Edinburgh大学的LCF</li>
<li>INRIA的Coq</li>
<li>Edinburgh大学的LEGO</li>
<li>Goteborg的ALF</li>
</ol>
<p>其中，Coq和LEGO是基于构造演算CoC，与Martin-Lof直觉类型论的作用类似，也是提供了一种逻辑框架，利用了把命题解释成集合的思想。两者的区别是：Martin-Lof是直谓的（predicative），而CoC是非直谓的（impredicative）。所谓非直谓的，就是指可以对所有命题的类型Prop进行全称量化来构造类型。因此Martin-Lof直觉类型论只能够结实谓词逻辑，不能解释二姐逻辑，而CoC则能够解释高阶逻辑。</p>
<h1 id="直觉主义（构造）逻辑和经典逻辑"><a href="#直觉主义（构造）逻辑和经典逻辑" class="headerlink" title="直觉主义（构造）逻辑和经典逻辑"></a>直觉主义（构造）逻辑和经典逻辑</h1><p>直觉注意逻辑更多的从证明论和模型论的角度展现逻辑：也就是说，它是一个构造的逻辑（constructive logic）。所谓构造性（constructivity）是指：与经典逻辑只关心公式的真值不同，构造逻辑关注的是实际的证明对象本身。“构造”可以指一个过程以及执行该过程的结果。</p>
<p>两者的主要不同在于语义基础不同。经典逻辑的基础是真值函数的语义：每个命题都为真或者假，这是Tarski语义的本质。而在直觉主义（构造）逻辑中，命题的定义就是把该命题的证明写下来，只有当存在一个与该命题对应的证明对象时，命题才为真，这是Brouwer-Heyting-Kolmogorov基于证明论语义的本质。因此从构造逻辑的角度来说，命题的真等价于命题的可证明性。其余区别见表：</p>
<p><img src="https://raw.githubusercontent.com/imonce/imgs/master/20190822154358.png"></p>
<h1 id="Curry-Howard同态"><a href="#Curry-Howard同态" class="headerlink" title="Curry-Howard同态"></a>Curry-Howard同态</h1><p>Curry-Howard同态在有类型的lambda演算和直觉命题逻辑之间建立了密切的关系。</p>
<p>用 $t:\sigma$ 表示项t具有类型 $\sigma$ 。在有类型lambda演算中项的构造有三种：变量（用x，y，z等表示）；抽象（用 $\lambda x.t$ 表示）；应用（用tu表示）。构造项的规则用自然演绎的方式描述如下：</p>
<p>变量形成规则： $\frac{}{x:\sigma \to x:\sigma}$ </p>
<p>抽象形成规则： $\frac{\Gamma,x:\sigma \to t:r}{\Gamma \mapsto (\lambda x.t):\sigma \to r}$ </p>
<p>变量形成规则： $\frac{\Gamma \mapsto t:\sigma \to r \Delta \mapsto u:\sigma}{\Gamma,\Delta \mapsto (tu):\sigma}$ </p>
<p>对上边的规则形式进行改造：</p>
<ol>
<li>把其中的项都去掉</li>
<li>用蕴含符号 $\Rightarrow$ 取代函数符号 $\to$ </li>
<li>用逻辑共识取代项</li>
</ol>
<p>则可以得到直觉逻辑的自然演绎表示</p>
<p>公理： $\frac{}{A\mapsto A}$ </p>
<p>引入规则： $\frac{\Gamma, A \mapsto B}{\Gamma \mapsto A\Rightarrow B}(\Rightarrow I)$ </p>
<p>消除规则： $\frac{\Gamma \mapsto A\Rightarrow B\Delta \mapsto A}{\Gamma,\Delta \mapsto B}(\Rightarrow E)$ </p>
<p>这三条规则分别是直觉逻辑的自然演绎系统的定理、蕴含引入和蕴含消除规则。这就是Curry=Howard同态。</p>
<p>总结：</p>
<ol>
<li>lambda演算的项（或函数式语言程序）的类型与直觉逻辑的公式之间的对应：公式作为类型（formula-as-types）</li>
<li>lambda演算的项与逻辑的证明对应：变量与公理对应，抽象与 $\Rightarrow$ 引入规则对应，应用与 $\Rightarrow$ 消除规则对应。而lambda演算的项就是函数式语言的程序，这就是：证明作为程序（proofs-as-programs）</li>
<li>lambda演算与beta规约的过程与逻辑中的规范化过程对应，这就是计算作为规范化（computation-as-normalization）</li>
</ol>
<h1 id="Martin-Lof直觉类型论概述"><a href="#Martin-Lof直觉类型论概述" class="headerlink" title="Martin-Lof直觉类型论概述"></a>Martin-Lof直觉类型论概述</h1><h2 id="对命题的直觉解释：命题作为集合"><a href="#对命题的直觉解释：命题作为集合" class="headerlink" title="对命题的直觉解释：命题作为集合"></a>对命题的直觉解释：命题作为集合</h2><p>类型论不是基于谓词演算，它的逻辑常熟市通过命题和集合之间的Curry-Howard同态解释的：命题被解释称集合，集合的元素代表了该命题的证明。</p>
<p>1）逻辑蕴含： $A \supset B$ </p>
<ul>
<li>$A \supset B$ 的证明是一个函数（方法，证明）。对A的每一证明，给出B的一个证明。</li>
<li>$A \supset B$ 等价于 $A \to B$ ，是从A到B的函数的集合。</li>
<li>集合 $A \to B$ 中元素都是函数，形式为 $\lambda x.b$ ，其中 $b\in B$ ，并且b可能依赖于 $x \in A$ 。</li>
</ul>
<p>2）逻辑合取： $A \wedge B$ </p>
<ul>
<li>$A \wedge B$ 的证明是一个有序组，其中第一分量是A的每一证明，第二分量是B的一个证明。</li>
<li>$A \wedge B$ 等价于 $A \times B$ ，是A与B的笛卡尔积。</li>
<li>集合 $A \times B$ 中元素的形式为(a,b)，其中 $a\in A, b \in B$ 。</li>
</ul>
<p>3）逻辑析取： $A \vee B$ </p>
<ul>
<li>一个析取是构造地真，当且仅当我们能够证明析取式之一。所以， $A \vee B$ 的证明包括：A或者B的一个证明，加上有关到底是A还是B的证明的信息。</li>
<li>$A\vee B$ 等价于 A + B，是A与B的不想交并。</li>
<li>集合A+B中的元素的形式为inl(a)或inr(b)，其中 $a\in A, b \in B$ .</li>
</ul>
<p>4）逻辑非： $\not A$ </p>
<ul>
<li>命题A的反可以定义为： $\not A \equiv A \supset \perp$ 。其中 $\perp$ 代表荒谬（absurdity）。即一个没有证明的命题。如果用 $\Phi$ 代表空集，则利用逻辑蕴含的解释，有 </li>
<li>$\not A$ 等价于 $A \to \Phi$ 。</li>
</ul>
<p>为了对用两次定义的命题进行解释，我们来定义在集合族上的操作，即集合B依赖于集合A中的元素x。用 $B[x\leftarrow a]$ 表示把B中所有自由出现的x都用a替换后得到的表达式。</p>
<p>5）存在量词： $(\exists x \in A)B$ </p>
<ul>
<li>$(\exists x \in A)B$ 的证明包括：集合A的一个元素的构造，以及 $B[x\leftarrow a]$ 的一个证明。因此， $(\exists x \in A)B$ 的证明是一有序对，其第一分量是集合A的一个元素，第二分量是  $B[x\leftarrow a]$ 的一个证明。</li>
<li>$(\exists x \in A)B$ 等价于 $(\Sigma x\in A)B$ ， $(\Sigma x\in A)B$ 是一集合族的不相交并（disjoint union）。</li>
<li>集合中 $(\Sigma x\in A)B$ 中元素的形式为序偶  &lt;a,b&gt; ，其中 $a\in A, b \in B[x \leftarrow a]$。</li>
</ul>
<p>6）全称量词： $(\forall x\in A)B$ </p>
<ul>
<li>$(\forall x \in A)B$ 的证明是一个函数（方法，程序），对于集合A中的每一个元素a给出 $B[x\leftarrow a]$ 的一个证明。因此，</li>
<li>$(\forall x \in A)B$ 等价于 $(\prod x\in A)B$ ， $(\prod x\in A)B$ 是一集合族的笛卡尔积。</li>
<li>集合中 $(\prod x\in A)B$ 中元素都是函数，当应用与集合A中元素a时，给出集合 $B[x\leftarrow a]$ 中的一个元素。该集合中的元素形式为 $\lambda x.b$ ，其中 $b\in B$ ，并且b和B都可能依赖于 $x\in A$ 。</li>
</ul>
<h2 id="类型的概念"><a href="#类型的概念" class="headerlink" title="类型的概念"></a>类型的概念</h2><p>类型轮中最基本的概念是类型的概念。对类型的直觉解释需要两方面的内容：</p>
<ol>
<li>说明类型的对象是什么</li>
<li>说明该类型的两个对象相等的意义</li>
</ol>
<p>类型论中有四种断言形式，对他们的直觉解释如下：</p>
<ol>
<li>A type，A是一个类型。</li>
<li>A=B，A和B是相等的类型。</li>
<li>$a\in A$ ，a是类型A中的一个对象。</li>
<li>$a=b\in A$ ，a和b是类型A中的相等对象</li>
</ol>
<h2 id="假言断言"><a href="#假言断言" class="headerlink" title="假言断言"></a>假言断言</h2><p>前边的四种断言不依赖于任何假设，假言断言（hypothetical judgement）通常都有一个上下文（context）.</p>
<p>下面我们只对当上下文的长度为1分别对前面4中断言的假言形式进行解释，其他可以通过归纳解释得到：上下文长度为0时，就是上一节的情况。以下使C是任意不依赖于任何假设的类型。</p>
<ol>
<li>A type $[x\in C]$ ，当 $[x\in C]$ 时，A是一类型</li>
<li>A = B $[x\in C]$ ，A和B是类型C上相等的类型族</li>
<li>$a\in A[x\in C]$ ，a是依赖于 $[x\in C]$ 的类型A中的一个对象</li>
<li>$a=b\in A[x\in C]$ ，a和b是依赖于 $[x\in C]$ 的类型A中的相等对象</li>
</ol>
<h2 id="类型组成"><a href="#类型组成" class="headerlink" title="类型组成"></a>类型组成</h2><ul>
<li>产生基本类型的方式<ul>
<li>类型Set</li>
<li>如果 $A\in Set$ ，A中元素的类型： $\frac{A\in Set}{El(A)type}$ </li>
</ul>
</li>
<li>引入其他类型的方式<ul>
<li>函数类型： $\frac{AtypeBtype[x\in A]}{(x\in A)Btype}$ ，相等函数类型 $\frac{A=A’B=B’[x\in A]}{(x\in A)B=(x\in A’)B’}$ <ul>
<li>把函数应用于对象： $\frac{c\in (x\in A)Ba\in A}{c(a)\in B[x\leftarrow a]}$ ， $\frac{c\in (x\in A)Ba=b\in A}{c(a)=c(b)\in B[x\leftarrow a]}$   </li>
<li>引入函数的基本方法是对表达式共的一个变量进行抽象。： $\frac{b\in B[x\in A]}{[x]b\in (x\in A)B}$ </li>
</ul>
</li>
<li>归纳定义的集合</li>
</ul>
</li>
</ul>
<h2 id="常数的引入"><a href="#常数的引入" class="headerlink" title="常数的引入"></a>常数的引入</h2><p>新的常数：</p>
<ul>
<li>定义常数（defined constant）：用其他对象来定义的<ul>
<li>显示定义常数：给出明确定义，实际上是某个类型中对象的简写</li>
<li>隐式定义常数：用于说明当把它应用于它的参数后，得到什么定义者</li>
</ul>
</li>
<li>原始常数（primitive constant），值就是常数本身，只有一个类型，没有定义，也成为构造子（constructor），如自然数集合的定义就是通过声明以下常数：<ul>
<li>$N\in Set$ </li>
<li>$succ\in (N)N$ </li>
<li>$0\in N$ </li>
</ul>
</li>
</ul>

          
          
          
          
          
          
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/4/"><i class="fa fa-angle-left" aria-label="Previous page"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/4/">4</a><span class="page-number current">5</span><a class="page-number" href="/page/6/">6</a><span class="space">&hellip;</span><a class="page-number" href="/page/14/">14</a><a class="extend next" rel="next" href="/page/6/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="C_Meng"
      src="/images/C_Meng.png">
  <p class="site-author-name" itemprop="name">C_Meng</p>
  <div class="site-description" itemprop="description">A stupid old man with a humble learning heart. And his dog.</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">134</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">32</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">208</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/imonce" title="GitHub → https://github.com/imonce" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:imonce@outlook.com" title="E-Mail → mailto:imonce@outlook.com" rel="noopener" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://weibo.com/3912390829/profile?topnav=1&wvr=6&is_all=1" title="Weibo → https://weibo.com/3912390829/profile?topnav=1&wvr=6&is_all=1" rel="noopener" target="_blank"><i class="fab fa-weibo fa-fw"></i>Weibo</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/moescee" title="Twitter → https://twitter.com/moescee" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>



      </div><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<ins class="adsbygoogle"
     style="display:block"
     data-ad-client="ca-pub-1831623022964098"
     data-ad-slot="5648729926"
     data-ad-format="auto"
     data-full-width-responsive="true"></ins>
<script>
     (adsbygoogle = window.adsbygoogle || []).push({});
</script>
    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">C_Meng</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>


  <div style="display: none;">
    <script src="//s95.cnzz.com/z_stat.php?id=1279293837&web_id=1279293837"></script>
  </div>






      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>
<script src="/js/utils.js"></script><script src="/js/motion.js"></script>
<script src="/js/schemes/pisces.js"></script>
<script src="/js/next-boot.js"></script>



  
  <script>
    (function(){
      var canonicalURL, curProtocol;
      //Get the <link> tag
      var x=document.getElementsByTagName("link");
		//Find the last canonical URL
		if(x.length > 0){
			for (i=0;i<x.length;i++){
				if(x[i].rel.toLowerCase() == 'canonical' && x[i].href){
					canonicalURL=x[i].href;
				}
			}
		}
    //Get protocol
	    if (!canonicalURL){
	    	curProtocol = window.location.protocol.split(':')[0];
	    }
	    else{
	    	curProtocol = canonicalURL.split(':')[0];
	    }
      //Get current URL if the canonical URL does not exist
	    if (!canonicalURL) canonicalURL = window.location.href;
	    //Assign script content. Replace current URL with the canonical URL
      !function(){var e=/([http|https]:\/\/[a-zA-Z0-9\_\.]+\.baidu\.com)/gi,r=canonicalURL,t=document.referrer;if(!e.test(r)){var n=(String(curProtocol).toLowerCase() === 'https')?"https://sp0.baidu.com/9_Q4simg2RQJ8t7jm9iCKT-xh_/s.gif":"//api.share.baidu.com/s.gif";t?(n+="?r="+encodeURIComponent(document.referrer),r&&(n+="&l="+r)):r&&(n+="?l="+r);var i=new Image;i.src=n}}(window);})();
  </script>




  <script src="/js/local-search.js"></script>








<script>
document.querySelectorAll('.pdfobject-container').forEach(element => {
  let url = element.dataset.target;
  let pdfOpenParams = {
    navpanes : 0,
    toolbar  : 0,
    statusbar: 0,
    pagemode : 'thumbs',
    view     : 'FitH'
  };
  let pdfOpenFragment = '#' + Object.entries(pdfOpenParams).map(([key, value]) => `${key}=${encodeURIComponent(value)}`).join('&');
  let fullURL = `/lib/pdf/web/viewer.html?file=${encodeURIComponent(url)}${pdfOpenFragment}`;

  if (NexT.utils.supportsPDFs()) {
    element.innerHTML = `<embed class="pdfobject" src="${url + pdfOpenFragment}" type="application/pdf" style="height: ${element.dataset.height};">`;
  } else {
    element.innerHTML = `<iframe src="${fullURL}" style="height: ${element.dataset.height};" frameborder="0"></iframe>`;
  }
});
</script>




  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'hBUFmUyAMBRRHULc0Y4SPPzw-gzGzoHsz',
      appKey     : 'WBQPPWjmwGWqvQcLqprPq0xs',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

</body>
</html>
